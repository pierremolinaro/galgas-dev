#----------------------------------------------------------------------------------------------------------------------*
#                                                                                                                      *
#  GALGAS LL1 routines                                                                                                 *
#                                                                                                                      *
#  Copyright (C) 2007, ..., 2013 Pierre Molinaro.                                                                      *
#                                                                                                                      *
#  e-mail : molinaro@irccyn.ec-nantes.fr                                                                               *
#                                                                                                                      *
#  This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public   *
#  License as published by the Free Software Foundation.                                                               *
#                                                                                                                      *
#  This program is distributed in the hope it will be useful, but WITHOUT ANY WARRANTY; without even the implied       *
#  warranty of MERCHANDIBILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more        *
#  details.                                                                                                            *
#                                                                                                                      *
#----------------------------------------------------------------------------------------------------------------------*
#                                                                                                                      *
#        M U L T I - M E T H O D   L I S T M A P                                                                       *
#                                                                                                                      *
#----------------------------------------------------------------------------------------------------------------------*

listmap @genericCategoryMethodListMap (@lstringlist)

#----------------------------------------------------------------------------------------------------------------------*
#                                                                                                                      *
#  B U I L D    M U L T I - M E T H O D S    L I S M A P S                                                             *
#                                                                                                                      *
#----------------------------------------------------------------------------------------------------------------------*

method @semanticDeclarationAST buildCategoryListMaps
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryModifierListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryMethodListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryGetterListMap {
}

#----------------------------------------------------------------------------------------------------------------------*

override method @abstractCategoryModifierAST buildCategoryListMaps
  ?!@genericCategoryMethodListMap ioAbstractCategoryModifierListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryMethodListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryGetterListMap {
  ioAbstractCategoryModifierListMapAST +=
    ![mTypeName string]
    !mAbstractCategoryModifierName
}

#----------------------------------------------------------------------------------------------------------------------*

override method @categoryModifierAST buildCategoryListMaps
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryModifierListMapAST
  ?!@genericCategoryMethodListMap ioCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryMethodListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryGetterListMap {
  ioCategoryModifierListMap +=
    ![mTypeName string]
    !mCategoryModifierName
}

#----------------------------------------------------------------------------------------------------------------------*

override method @overridingCategoryModifierAST buildCategoryListMaps
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryModifierListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryModifierListMap
  ?!@genericCategoryMethodListMap ioOverridingCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryMethodListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryGetterListMap {
  ioOverridingCategoryModifierListMap +=
    ![mTypeName string]
    !mOverridingCategoryModifierName
}

#----------------------------------------------------------------------------------------------------------------------*

override method @overridingAbstractCategoryModifierAST buildCategoryListMaps
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryModifierListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryModifierListMap
  ?!@genericCategoryMethodListMap ioOverridingAbstractCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryMethodListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryGetterListMap {
  ioOverridingAbstractCategoryModifierListMap +=
    ![mTypeName string]
    !mOverridingCategoryModifierName
}

#----------------------------------------------------------------------------------------------------------------------*

override method @abstractCategoryMethodAST buildCategoryListMaps
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryModifierListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryModifierListMap
  ?!@genericCategoryMethodListMap ioAbstractCategoryMethodListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryGetterListMap {
  ioAbstractCategoryMethodListMapAST +=
    ![mTypeName string]
    !mAbstractCategoryMethodName
}

#----------------------------------------------------------------------------------------------------------------------*

override method @categoryMethodAST buildCategoryListMaps
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryModifierListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryMethodListMapAST
  ?!@genericCategoryMethodListMap ioCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryGetterListMap {
  ioCategoryMethodListMap +=
    ![mTypeName string]
    !mCategoryMethodName
}

#----------------------------------------------------------------------------------------------------------------------*

override method @overridingCategoryMethodAST buildCategoryListMaps
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryModifierListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryMethodListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryMethodListMap
  ?!@genericCategoryMethodListMap ioOverridingCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryGetterListMap {
  ioOverridingCategoryMethodListMap +=
    ![mTypeName string]
    !mOverridingCategoryMethodName
}

#----------------------------------------------------------------------------------------------------------------------*

override method @overridingAbstractCategoryMethodAST buildCategoryListMaps
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryModifierListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryMethodListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryMethodListMap
  ?!@genericCategoryMethodListMap ioOverridingAbstractCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryGetterListMap {
  ioOverridingAbstractCategoryMethodListMap +=
    ![mTypeName string]
    !mOverridingCategoryMethodName
}

#----------------------------------------------------------------------------------------------------------------------*

override method @abstractCategoryGetterAST buildCategoryListMaps
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryModifierListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryMethodListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryMethodListMap
  ?!@genericCategoryMethodListMap ioAbstractCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryGetterListMap {
  ioAbstractCategoryGetterListMap +=
    ![mTypeName string]
    !mAbstractCategoryGetterName
}

#----------------------------------------------------------------------------------------------------------------------*

override method @categoryGetterAST buildCategoryListMaps
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryModifierListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryMethodListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryGetterListMap
  ?!@genericCategoryMethodListMap ioCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryGetterListMap {
  ioCategoryGetterListMap +=
    ![mTypeName string]
    !mCategoryGetterName
}

#----------------------------------------------------------------------------------------------------------------------*

override method @overridingCategoryGetterAST buildCategoryListMaps
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryModifierListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryMethodListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioCategoryGetterListMap
  ?!@genericCategoryMethodListMap ioOverridingCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryGetterListMap {
  ioOverridingCategoryGetterListMap +=
    ![mTypeName string]
    !mOverridingCategoryGetterName
}

#----------------------------------------------------------------------------------------------------------------------*

override method @overridingAbstractCategoryGetterAST buildCategoryListMaps
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryModifierListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryModifierListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryMethodListMapAST
  ?!@genericCategoryMethodListMap unused ioCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioOverridingAbstractCategoryMethodListMap
  ?!@genericCategoryMethodListMap unused ioAbstractCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioCategoryGetterListMap
  ?!@genericCategoryMethodListMap unused ioOverridingCategoryGetterListMap
  ?!@genericCategoryMethodListMap ioOverridingAbstractCategoryGetterListMap {
  ioOverridingAbstractCategoryGetterListMap +=
    ![mTypeName string]
    !mAbstractCategoryGetterName
}

#----------------------------------------------------------------------------------------------------------------------*
#                                                                                                                      *
#    D E S C E N D A N T    C L A S S    L I S T M A P                                                                 *
#                                                                                                                      *
#----------------------------------------------------------------------------------------------------------------------*

listmap @descendantClassListMap (@unifiedTypeMapProxyList)

#----------------------------------------------------------------------------------------------------------------------*
#                                                                                                                      *
#  C A T E G O R Y    M E T H O D    M A P                                                                             *
#                                                                                                                      *
# Used for checking a category-method is defined once for a type                                                       *
#----------------------------------------------------------------------------------------------------------------------*

map @categoryMethodMapForGlobalCheckings {
  insert insertKey error message "the '%K' category method is already declared in %L"
}

#----------------------------------------------------------------------------------------------------------------------*
#                                                                                                                      *
#  C A T E G O R Y    M O D I F I E R    M A P                                                                         *
#                                                                                                                      *
# Used for checking a category-setter is defined once for a type                                                       *
#----------------------------------------------------------------------------------------------------------------------*

map @categoryModifierMapForGlobalCheckings {
  insert insertKey error message "the '%K' category setter is already declared in %L"
}

#----------------------------------------------------------------------------------------------------------------------*
#                                                                                                                      *
#  C A T E G O R Y    G E T T E R    M A P                                                                             *
#                                                                                                                      *
# Used for checking a category-method is defined once for a type                                                       *
#----------------------------------------------------------------------------------------------------------------------*

map @categoryGetterMapForGlobalCheckings {
  insert insertKey error message "the '%K' category getter is already declared in %L"
}

#----------------------------------------------------------------------------------------------------------------------*

func outputDirectory ?let @lstring inSourceFile ->  @string outOuputDirectory {
  if [inSourceFile characterAtIndex !0] == '/' then
    outOuputDirectory = [inSourceFile stringByDeletingLastPathComponent]
    outOuputDirectory += "/GALGAS_OUTPUT"
  else
    outOuputDirectory = "GALGAS_OUTPUT"
  end
}

#----------------------------------------------------------------------------------------------------------------------*

proc checkCategoryModifierDefinitionForClass
  ?let @string inClassNameForErrorSignaling
  ?let @string inClassName
  ?let @lstring inAbstractCategoryModifierName
  ?let @descendantClassListMap inDescendantClassListMap
  ?let @genericCategoryMethodListMap inOverridingCategoryMethodListMap
  ?let @unifiedTypeMap inUnifiedTypeMap {
  let @unifiedTypeMapProxyList descendantClasses = [inDescendantClassListMap listForKey !inClassName]
  for () in descendantClasses do
    let @lstring descendantClassName = [mType lkey]
    @lstringlist overridingMethods = [inOverridingCategoryMethodListMap listForKey ![descendantClassName string]]
    @bool found = false
    for () in overridingMethods while not found do
      found = [inAbstractCategoryModifierName string] == [mValue string]
    end
    if not found then
      if not [mType mIsConcrete] then
        checkCategoryModifierDefinitionForClass (
          !inClassNameForErrorSignaling
          ![descendantClassName string]
          !inAbstractCategoryModifierName
          !inDescendantClassListMap
          !inOverridingCategoryMethodListMap
          !inUnifiedTypeMap
        )
      else
        error inAbstractCategoryModifierName: "an abstract category method '" + inAbstractCategoryModifierName + "' is defined for abstract class '@"
        + inClassNameForErrorSignaling
        + "', but concrete descendant class '@" + descendantClassName + "' does not implement this method" 
      end
    end
  end
}

#----------------------------------------------------------------------------------------------------------------------*

proc checkCategoryMethodDefinitionForClass
  ?let @string inClassNameForErrorSignaling
  ?let @string inClassName
  ?let @lstring inAbstractCategoryMethodName
  ?let @descendantClassListMap inDescendantClassListMap
  ?let @genericCategoryMethodListMap inOverridingCategoryMethodListMap
  ?let @unifiedTypeMap inUnifiedTypeMap
{
  let @unifiedTypeMapProxyList descendantClasses = [inDescendantClassListMap listForKey !inClassName]
  for () in descendantClasses do
    let @lstring descendantClassName = [mType lkey]
    @lstringlist overridingMethods = [inOverridingCategoryMethodListMap listForKey ![descendantClassName string]]
    @bool found = false
    for () in overridingMethods while not found do
      found = [inAbstractCategoryMethodName string] == [mValue string]
    end
    if not found then
      if not [mType mIsConcrete] then
        checkCategoryMethodDefinitionForClass (
          !inClassNameForErrorSignaling
          ![descendantClassName string]
          !inAbstractCategoryMethodName
          !inDescendantClassListMap
          !inOverridingCategoryMethodListMap
          !inUnifiedTypeMap
        )
      else
        error inAbstractCategoryMethodName: "an abstract category method '" + inAbstractCategoryMethodName + "' is defined for abstract class '@"
        + inClassNameForErrorSignaling
        + "', but concrete descendant class '@" + descendantClassName + "' does not implement this method" 
      end
    end
  end
}

#----------------------------------------------------------------------------------------------------------------------*

proc checkCategoryGetterDefinitionForClass
  ?let @string inClassNameForErrorSignaling
  ?let @string inClassName
  ?let @lstring inAbstractCategoryGetterName
  ?let @descendantClassListMap inDescendantClassListMap
  ?let @genericCategoryMethodListMap inOverridingCategoryGetterListMap
  ?let @unifiedTypeMap inUnifiedTypeMap
{
  let @unifiedTypeMapProxyList descendantClasses = [inDescendantClassListMap listForKey !inClassName]
  for () in descendantClasses do
    @lstring descendantClassName = [mType lkey]
    @lstringlist overridingReaders = [inOverridingCategoryGetterListMap listForKey ![descendantClassName string]]
    @bool found = false
    for () in overridingReaders while not found do
      found = [inAbstractCategoryGetterName string] == [mValue string]
    end
    if not found then
      if not [mType mIsConcrete] then
        checkCategoryGetterDefinitionForClass (
          !inClassNameForErrorSignaling
          ![descendantClassName string]
          !inAbstractCategoryGetterName
          !inDescendantClassListMap
          !inOverridingCategoryGetterListMap
          !inUnifiedTypeMap
        )
      else
        error inAbstractCategoryGetterName: "an abstract category getter '" + inAbstractCategoryGetterName + "' is defined for abstract class '@"
        + inClassNameForErrorSignaling
        + "', but concrete descendant class '@" + descendantClassName + "' does not implement this getter" 
      end
    end
  end
}

#----------------------------------------------------------------------------------------------------------------------*

proc performGalgas3ProjectGlobalCheckings
  ?let @semanticContext inSemanticContext
  ?let @semanticDeclarationListAST inSemanticDeclarationList
{
  if @application.verboseOutput then
    message "*** Perform global checkings\n"
  end
#------ Build descendant type list map
# For every type, a list of its directed descendants is associated
  var descendantClassListMap =@descendantClassListMap.emptyMap{}
  for () in inSemanticContext.mTypeMap do
     if not [mSuperType isNull] then
       descendantClassListMap +=
         ![mSuperType key]
         !@unifiedTypeMap-proxy. searchKey {!inSemanticContext.mTypeMap !lkey}
     end
  end
#--- Build Category method listmaps
  var abstractCategoryMethodListMap =@genericCategoryMethodListMap.emptyMap{}
  var categoryMethodListMap =@genericCategoryMethodListMap.emptyMap{}
  var overridingCategoryMethodListMap =@genericCategoryMethodListMap.emptyMap{}
  var overridingAbstractCategoryMethodListMap =@genericCategoryMethodListMap.emptyMap{}
  var abstractCategoryGetterListMap =@genericCategoryMethodListMap.emptyMap{}
  var categoryReaderListMap =@genericCategoryMethodListMap.emptyMap{}
  var overridingCategoryGetterListMap =@genericCategoryMethodListMap.emptyMap{}
  var overridingAbstractCategoryGetterListMap =@genericCategoryMethodListMap.emptyMap{}
  var abstractCategoryModifierListMap =@genericCategoryMethodListMap.emptyMap{}
  var categoryModifierListMap =@genericCategoryMethodListMap.emptyMap{}
  var overridingCategoryModifierListMap =@genericCategoryMethodListMap.emptyMap{}
  var overridingAbstractCategoryModifierListMap =@genericCategoryMethodListMap.emptyMap{}
  for () in inSemanticDeclarationList do
    [mSemanticDeclaration buildCategoryListMaps
      !?abstractCategoryModifierListMap
      !?categoryModifierListMap
      !?overridingCategoryModifierListMap
      !?overridingAbstractCategoryModifierListMap
      !?abstractCategoryMethodListMap
      !?categoryMethodListMap
      !?overridingCategoryMethodListMap
      !?overridingAbstractCategoryMethodListMap
      !?abstractCategoryGetterListMap
      !?categoryReaderListMap
      !?overridingCategoryGetterListMap
      !?overridingAbstractCategoryGetterListMap
    ]
  end
#------ Check Category
  if @uint.errorCount == 0 then
  #--- A given abstract category modifier is defined only once for a class
    for () in abstractCategoryModifierListMap do
      var categoryModifierMap =@categoryModifierMapForGlobalCheckings.emptyMap{}
      for () in mList do
        [!?categoryModifierMap insertKey !mValue]
      end
    end  
  #--- A given base category modifier is defined only once for a class
    for () in categoryModifierListMap do
      var categoryModifierMap =@categoryModifierMapForGlobalCheckings.emptyMap{}
      for () in mList do
        [!?categoryModifierMap insertKey !mValue]
      end
    end  
  #--- A given overriding category modifier is defined only once for a class
    for () in overridingCategoryModifierListMap do
      var categoryModifierMap =@categoryModifierMapForGlobalCheckings.emptyMap{}
      for () in mList do
        [!?categoryModifierMap insertKey !mValue]
      end
    end  
  #--- A given overriding abstract category modifier is defined only once for a class
    for () in overridingAbstractCategoryMethodListMap do
      var categoryModifierMap =@categoryModifierMapForGlobalCheckings.emptyMap{}
      for () in mList do
        [!?categoryModifierMap insertKey !mValue]
      end
    end  
  #------ Check that for every abstract category modifier, an overridden category modifier defined in an concrete subclass
    for () in abstractCategoryModifierListMap do
      for () in mList do
        checkCategoryModifierDefinitionForClass (
          !key
          !key
          !mValue
          !descendantClassListMap
          !overridingCategoryModifierListMap
          !inSemanticContext.mTypeMap
        )
      end
    end
  #------ Check that for every overriding abstract category modifier, an overridden category modifier defined in an concrete subclass
    for () in overridingAbstractCategoryModifierListMap do
      for () in mList do
        checkCategoryModifierDefinitionForClass (
          !key
          !key
          !mValue
          !descendantClassListMap
          !overridingCategoryModifierListMap
          !inSemanticContext.mTypeMap
        )
      end
    end
  #--- A given abstract category method is defined only once for a class
    for () in abstractCategoryMethodListMap do
      var categoryMethodMap =@categoryMethodMapForGlobalCheckings.emptyMap{}
      for () in mList do
        [!?categoryMethodMap insertKey !mValue]
      end
    end  
  #--- A given base category method is defined only once for a class
    for () in categoryMethodListMap do
      var categoryMethodMap =@categoryMethodMapForGlobalCheckings.emptyMap{}
      for () in mList do
        [!?categoryMethodMap insertKey !mValue]
      end
    end  
  #--- A given overriding category method is defined only once for a class
    for () in overridingCategoryMethodListMap do
      var categoryMethodMap =@categoryMethodMapForGlobalCheckings.emptyMap{}
      for () in mList do
        [!?categoryMethodMap insertKey !mValue]
      end
    end  
  #--- A given overriding abstract category method is defined only once for a class
    for () in overridingAbstractCategoryMethodListMap do
      var categoryMethodMap =@categoryMethodMapForGlobalCheckings.emptyMap{}
      for () in mList do
        [!?categoryMethodMap insertKey !mValue]
      end
    end  
  #------ Check that for every abstract category method, an overridden category method defined in an concrete subclass
    for () in abstractCategoryMethodListMap do
      for () in mList do
        checkCategoryMethodDefinitionForClass (
          !key
          !key
          !mValue
          !descendantClassListMap
          !overridingCategoryMethodListMap
          !inSemanticContext.mTypeMap
        )
      end
    end
  #------ Check that for every abstract category method, an overridden category method defined in an concrete subclass
    for () in overridingAbstractCategoryMethodListMap do
      for () in mList do
        checkCategoryMethodDefinitionForClass (
          !key
          !key
          !mValue
          !descendantClassListMap
          !overridingCategoryMethodListMap
          !inSemanticContext.mTypeMap
        )
      end
    end
  #------ Check Category getters
##--- Check that for every abstract category getter, an overridden category getter
##    defined in an concrete subclass
  #--- A given abstract category getter is defined only once for a class
    for () in abstractCategoryGetterListMap do
      var CategoryGetterMap =@categoryGetterMapForGlobalCheckings.emptyMap{}
      for () in mList do
        [!?CategoryGetterMap insertKey !mValue]
      end
    end  
  #--- A given base category getter is defined only once for a class
    for () in categoryReaderListMap do
      var CategoryGetterMap =@categoryGetterMapForGlobalCheckings.emptyMap{}
      for () in mList do
        [!?CategoryGetterMap insertKey !mValue]
      end
    end  
  #--- A given overriding category getter is defined only once for a class
    for () in overridingCategoryGetterListMap do
      var CategoryGetterMap =@categoryGetterMapForGlobalCheckings.emptyMap{}
      for () in mList do
        [!?CategoryGetterMap insertKey !mValue]
      end
    end  
  #--- Check every abstract category getter is implemented by every inherited concrete type
    for () in abstractCategoryGetterListMap do
      for () in mList do
        checkCategoryGetterDefinitionForClass (
          !key
          !key
          !mValue
          !descendantClassListMap
          !overridingCategoryGetterListMap
          !inSemanticContext.mTypeMap
        )
      end
    end
  #--- Check every abstract category getter is implemented by every inherited concrete type
    for () in overridingAbstractCategoryGetterListMap do
      for () in mList do
        checkCategoryGetterDefinitionForClass (
          !key
          !key
          !mValue
          !descendantClassListMap
          !overridingCategoryGetterListMap
          !inSemanticContext.mTypeMap
        )
      end
    end
  end
}

#----------------------------------------------------------------------------------------------------------------------*
#                                                                                                                      *
#           G E N E R A T I O N    F I L E W R A P P E R S                                                             *
#                                                                                                                      *
#----------------------------------------------------------------------------------------------------------------------*

filewrapper typeDumpGenerationTemplate in "../generation_templates/target_generation" {
}{
}{
  template typeDump "typeDump.html.galgasTemplate"
    ?@string PROJECT_NAME
    ?@unifiedTypeMap UNIFIED_TYPE_MAP
    ?@stringset FIRST_LETTER_SET
    ?@string TABLE_OF_TYPES_STRING
}

#----------------------------------------------------------------------------------------------------------------------*

func linkForType ?let @string inTypeName -> @string outResult {
  outResult = "<a class=\"header_link\" href=\"#" + inTypeName + "\">@" + inTypeName + "</a>"
}

#----------------------------------------------------------------------------------------------------------------------*

