#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#                                           
#  Copyright (C) 2007, ..., 2015 Pierre Molinaro.
#                                           
#  e-mail : pierre@pcmolinaro.name          
#                                           
#  This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public
#  License as published by the Free Software Foundation.
#                                           
#  This program is distributed in the hope it will be useful, but WITHOUT ANY WARRANTY; without even the implied
#  warranty of MERCHANDIBILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
#  details.                                 
#                                           
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

abstract refclass @semanticExpressionAST {
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#                                           
#   F O R M A L    A R G U M E N T S    P A S S I N G    M O D E S                                             
#                                           
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

enum @formalArgumentPassingModeAST {
  case argumentIn
  case argumentOut
  case argumentInOut
  case argumentConstantIn
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

getter @formalArgumentPassingModeAST string -> @string {
  switch self
    case argumentConstantIn : result = "?let"
    case argumentIn : result = "?"
    case argumentOut : result = "!"
    case argumentInOut : result = "?!"
  end
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

getter @formalArgumentPassingModeAST formalArgumentMessage -> @string {
  switch self
    case argumentConstantIn : result = "a constant input (?let) formal argument"
    case argumentIn : result = "an input (?) formal argument"
    case argumentOut : result = "an output (!) formal argument"
    case argumentInOut : result = "an input/output (?!) formal argument"
  end
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#                                           
#  F O R M A L    P A R A M E T E R    L I S T   
#                                           
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

list @formalParameterListAST {
  public let @lstring mFormalSelector
  public let @formalArgumentPassingModeAST mFormalArgumentPassingMode
  public let @lstring mFormalArgumentTypeName
  public let @lstring mFormalArgumentName
  public let @bool mIsUnused
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#                                           
#  F O R M A L    I N P U T    P A R A M E T E R    L I S T                                                    
#                                           
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

list @formalInputParameterListAST {
  public let @lstring mFormalSelector
  public let @lstring mFormalArgumentTypeName
  public let @lstring mFormalArgumentName
  public let @bool mIsUnused
  public let @bool mIsConstant
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#                                           
#  A C T U A L    P A R A M E T E R         
#                                           
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

abstract refclass @actualParameterAST {
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @outputActualParameterAST : @actualParameterAST {
  public let @lstring mActualSelector
  public let @semanticExpressionAST mOutputActualParameterExpression
  public let @location mEndOfExpressionLocation
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @outputInputActualParameterAST : @actualParameterAST {
  public let @lstring mActualSelector
  public let @lstring mOutputInputActualParameterName
  public let @lstringlist mStructAttributeList
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @outputInputSingleJokerParameterAST : @actualParameterAST {
  public let @lstring mActualSelector
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @outputInputSelfParameterAST : @actualParameterAST {
  public let @lstring mActualSelector
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @outputInputJokerParameterAST : @actualParameterAST {
  public let @location mQualifierLocation
  public let @uint mJokerIndex
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @inputActualExistingVariableParameterAST : @actualParameterAST {
  public let @lstring mActualSelector
  public let @lstring mInputActualParameterName
  public let @lstringlist mPoisonedVarNameList
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @inputActualSelfPropertyParameterAST : @actualParameterAST {
  public let @lstring mActualSelector
  public let @lstring mInputActualSelfPropertyName
  public let @lstringlist mPoisonedVarNameList
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @inputActualSelfParameterAST : @actualParameterAST {
  public let @lstring mActualSelector
  public let @location mSelfLocation
  public let @lstringlist mPoisonedVarNameList
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @inputActualNewVariableParameterAST : @actualParameterAST {
  public let @lstring mActualSelector
  public let @lstring mInputOptionalActualTypeName
  public let @lstring mInputActualParameterName
  public let @lstringlist mPoisonedVarNameList
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @inputActualNewConstantParameterAST : @actualParameterAST {
  public let @lstring mActualSelector
  public let @lstring mInputOptionalActualTypeName
  public let @lstring mInputActualParameterName
  public let @bool mMarkedAsUnused
  public let @lstringlist mPoisonedVarNameList
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @inputSingleJokerActualParameterAST : @actualParameterAST {
  public let @lstring mActualSelector
  public let @lstringlist mPoisonedVarNameList
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @inputJokerActualParameterAST : @actualParameterAST {
  public let @location mQualifierLocation
  public let @uint mJokerIndex
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

list @actualParameterListAST {
  public let @actualParameterAST mActualParameter
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#                                           
#  A C T U A L    I N P U T    P A R A M E T E R    L I S T                                                    
#                                           
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

abstract refclass @abstractInputParameter {
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @inputParameterAnonymousVariable : @abstractInputParameter {
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @inputParameterVariable : @abstractInputParameter {
  public let @lstring mActualParameterName
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @inputParameterDeclaredVariable : @abstractInputParameter {
  public let @lstring mActualParameterTypeName
  public let @lstring mActualParameterName
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @inputParameterDeclaredConstant : @abstractInputParameter {
  public let @lstring mActualParameterTypeName
  public let @lstring mActualParameterName
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

list @actualInputParameterListAST {
  public let @lstring mActualSelector
  public let @abstractInputParameter mInputParameter
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

abstract refclass @syntaxInstructionAST {
  public let @location mInstructionLocation
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

abstract refclass @semanticInstructionAST : @syntaxInstructionAST {
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

list @semanticInstructionListAST {
  public let @semanticInstructionAST mInstruction
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

list @semanticDeclarationListAST {
  public let @semanticDeclarationAST mSemanticDeclaration
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#                                           
#    E X T E R N    R O U T I N E    D E C L A R A T I O N                                                     
#                                           
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @externRoutineDeclarationAST : @semanticDeclarationAST {
  public let @bool mIsInternal
  public let @lstring mRoutineName
  public let @formalParameterListAST mFormalArgumentList
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#                                           
#    R O U T I N E    D E C L A R A T I O N 
#                                           
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @procDeclarationAST : @externRoutineDeclarationAST {
  public let @semanticInstructionListAST mRoutineInstructionList
  public let @location mEndOfRoutineInstructionList
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#                                           
#    E X T E R N    F U N C T I O N    D E C L A R A T I O N                                                   
#                                           
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @externFunctionDeclarationAST : @semanticDeclarationAST {
  public let @lstring mFunctionName
  public let @formalInputParameterListAST mFormalArgumentList
  public let @lstring mResultTypeName
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#                                           
#    F U N C T I O N    D E C L A R A T I O N    
#                                           
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @functionDeclarationAST : @externFunctionDeclarationAST {
  public let @lstring mResultVariableName
  public let @semanticInstructionListAST mFunctionInstructionList
  public let @location mEndOfFunctionInstructionList
  public let @bool mIsInternal
  public let @bool mIsUsefull
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#                                           
#    O N C E    F U N C T I O N    D E C L A R A T I O N
#                                           
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @onceFunctionDeclarationAST : @semanticDeclarationAST {
  public let @lstring mFunctionName
  public let @lstring mResultTypeName
  public let @lstring mResultVariableName
  public let @semanticInstructionListAST mFunctionInstructionList
  public let @location mEndOfFunctionInstructionList
  public let @bool mIsInternal
  public let @bool mIsUsefull
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#                                           
#    Common Rules                           
#                                           
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

list @propertyInCollectionListAST {
  public let @bool isConstant %selector
  public let @lstring mPropertyTypeName
  public let @bool optional %selector
  public let @lstring mPropertyName
  public let @bool mIsPublic
  public let @lstringlist mAttributeList
  public let @propertyInCollectionInitializationAST mInitialization
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

enum @propertyInCollectionInitializationAST {
  case none
  case some (@semanticExpressionAST expression)
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#                                           
#    F I L E W R A P P E R    D E C L A R A T I O N     
#                                           
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

list @formalTemplateInputParameterListAST {
  public let @lstring mFormalTemplateSelector
  public let @lstring mFormalArgumentTypeName
  public let @lstring mFormalArgumentName
  public let @bool mIsUnused
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

list @filewrapperTemplateListAST {
  public let @lstring mFilewrapperTemplateName
  public let @lstring mFilewrapperTemplatePath
  public let @formalTemplateInputParameterListAST mFilewrapperTemplateFormalInputParameters
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @filewrapperDeclarationAST : @semanticDeclarationAST {
  public let @bool mIsInternal
  public let @string mSourceFileAbsolutePath
  public let @lstring mFilewrapperName
  public let @lstring mFilewrapperPath
  public let @lstringlist mFilewrapperTextFileExtensionList
  public let @lstringlist mFilewrapperBinaryFileExtensionList
  public let @filewrapperTemplateListAST mFilewrapperTemplateList
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

list @syntaxInstructionList {
  public let @syntaxInstructionAST mInstruction
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

list @nonTerminalLabelListAST {
  public let @lstring mLabelName
  public let @formalParameterListAST mFormalArgumentList
  public let @location mEndOfArgumentLocation
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

list @nonterminalDeclarationListAST {
  public let @lstring mNonterminalName
  public let @nonTerminalLabelListAST mLabels
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

list @syntaxRuleLabelListAST {
  public let @lstring mLabelName
  public let @formalParameterListAST mFormalArguments
  public let @location mEndOfArgumentLocation
  public let @syntaxInstructionList mSyntaxInstructionList
  public let @location mEndOfInstructionList
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

list @syntaxRuleListAST {
  public let @lstring mNonterminalName
  public let @syntaxRuleLabelListAST mLabelList
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#                                           
#   R E P E A T    I N S T R U C T I O N    
#                                           
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

list @listOfSyntaxInstructionList {
  public let @syntaxInstructionList mSyntaxInstructionList
  public let @location mEndOf_instructions
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#                                           
#   S Y N T A X    C O M P O N E N T    A S T    
#                                           
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

#! GALGAS 3 AST

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @galgas3SyntaxComponentAST : @semanticDeclarationAST {
  public let @lstring mSyntaxComponentName
  public let @lstring mLexiqueName 
  public let @nonterminalDeclarationListAST mNonterminalDeclarationList
  public let @syntaxRuleListAST mRuleList
  public let @bool mHasTranslateFeature
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

refclass @galgas3GrammarComponentAST : @semanticDeclarationAST {
  public let @lbool mHasIndexing
  public let @lstring mGrammarComponentName
  public let @lstring mGrammarClass
  public let @lstringlist mSyntaxComponents
  public let @lstring mStartSymbolName
  public let @nonTerminalLabelListAST mStartSymbolLabelList
  public let @lstringlist mUnusedNonterminalList
  public let @bool mHasTranslateFeature
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

list @galgas3SyntaxComponentListAST {
  public let @lstring mSyntaxComponentName
  public let @lstring mImportedLexiqueFilePath 
  public let @nonterminalDeclarationListAST mNonterminalDeclarationList
  public let @syntaxRuleListAST mRuleList
  public let @bool mHasTranslateFeature
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

list @galgas3SyntaxExtensionListAST {
  public let @lstring mSyntaxComponentName
  public let @nonterminalDeclarationListAST mNonterminalDeclarationList
  public let @syntaxRuleListAST mRuleList
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

listmap @syntaxExtensions (@galgas3SyntaxExtensionListAST)

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

list @prologueEpilogueList {
  public let @semanticInstructionListAST mInstructionList
  public let @location mEndOfInstructionList
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

list @programRuleList {
  public let @lstring mSourceFileExtension
  public let @lstring mSourceFileHelp
  public let @lstring mSourceFileVariableName
  public let @bool mSourceFileVariableNameIsUnused
  public let @lstring mReferenceGrammar # Empty string if no grammar
  public let @semanticInstructionListAST mInstructionList
  public let @location mEndOfInstructionList
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

struct @galgasDeclarationAST {
  public var @semanticDeclarationListAST mDeclarationList
  public var @galgas3SyntaxComponentListAST mSyntaxComponentList
  public var @syntaxExtensions mSyntaxExtensions
  public var @galgas3GUIComponentListAST mGUIComponentList
  public var @prologueEpilogueList mPrologueDeclarationList
  public var @programRuleList mSourceRuleList
  public var @prologueEpilogueList mEpilogueDeclarationList
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

