//---------------------------------------------------------------------------*
//                                                                           *
//                        File 'compileLexique.cpp'                          *
//                 Generated by version GALGAS_BETA_VERSION                  *
//                       june 7th, 2008, at 21h14'53"                        *
//                                                                           *
//---------------------------------------------------------------------------*

//--- START OF USER ZONE 1


//--- END OF USER ZONE 1

//---------------------------------------------------------------------------*

#include "version_libpm.h"
#if LIBPM_VERSION != THE_LIBPM_VERSION
  #error "This file has been compiled with a version of GALGAS different than the version of libpm"
#endif

//---------------------------------------------------------------------------*

#include <typeinfo>
#include "utilities/MF_MemoryControl.h"
#include "files/C_TextFileWrite.h"
#include "compileLexique.h"

//---------------------------------------------------------------------------*

#ifndef DO_NOT_GENERATE_CHECKINGS
  #define SOURCE_FILE_AT_LINE(line) "compileLexique.gSemantics", line
  #define COMMA_SOURCE_FILE_AT_LINE(line) , SOURCE_FILE_AT_LINE(line)
#else
  #define SOURCE_FILE_AT_LINE(line) 
  #define COMMA_SOURCE_FILE_AT_LINE(line) 
#endif

//---------------------------------------------------------------------------*
//                                                                           *
//             Include directives generated by grammar includes              *
//                                                                           *
//---------------------------------------------------------------------------*

#include "lexiqueLL1grammar.h"

//--- START OF USER ZONE 2


//--- END OF USER ZONE 2

//---------------------------------------------------------------------------*
//                                                                           *
//           Implementation of routine "compileLexiqueComponent"             *
//                                                                           *
//---------------------------------------------------------------------------*

void routine_compileLexiqueComponent (C_Compiler & _inLexique,
                                const GGS_lstring   var_cas_inSourceFile,
                                const GGS_string  /* var_cas_inOutputDirectory */ COMMA_UNUSED_LOCATION_ARGS) {
  #ifdef DEBUG_TRACE_ENABLED
    printf ("ENTER routine_compileLexiqueComponent at %s:%d\n", __FILE__, __LINE__) ;
  #endif
  GGS_lexiqueComponentRoot  var_cas_lexiqueComponentRoot ;
  lexiqueLL1grammar::_performSourceFileParsing_ (_inLexique,
                                  NULL,
                                  var_cas_inSourceFile,
                                  var_cas_lexiqueComponentRoot
                                  COMMA_SOURCE_FILE_AT_LINE (33)) ;
  GGS_stringset  var_cas_allowedLexicalTypeNameSet ;
  var_cas_allowedLexicalTypeNameSet = GGS_stringset ::constructor_emptySet (_inLexique COMMA_HERE) ;
  var_cas_allowedLexicalTypeNameSet._addAssign_operation (GGS_string (true, "lstring")) ;
  var_cas_allowedLexicalTypeNameSet._addAssign_operation (GGS_string (true, "lchar")) ;
  var_cas_allowedLexicalTypeNameSet._addAssign_operation (GGS_string (true, "luint")) ;
  var_cas_allowedLexicalTypeNameSet._addAssign_operation (GGS_string (true, "luint64")) ;
  var_cas_allowedLexicalTypeNameSet._addAssign_operation (GGS_string (true, "lsint")) ;
  var_cas_allowedLexicalTypeNameSet._addAssign_operation (GGS_string (true, "lsint64")) ;
  var_cas_allowedLexicalTypeNameSet._addAssign_operation (GGS_string (true, "ldouble")) ;
  GGS_lexicalAttributeMap  var_cas_lexicalAttributeMap ;
  var_cas_lexicalAttributeMap = GGS_lexicalAttributeMap ::constructor_emptyMap (_inLexique COMMA_HERE) ;
  {
    GGS_lexicalAttributeList::cEnumerator enumerator_2418 (var_cas_lexiqueComponentRoot.reader_mLexicalAttributeList (_inLexique COMMA_SOURCE_FILE_AT_LINE (45)), true) ;
    const GGS_lexicalAttributeList::cElement * operand_2418 = NULL ;
    while (((operand_2418 = (GGS_lexicalAttributeList::cElement *) enumerator_2418.nextObject ()))) {
      macroValidPointer (operand_2418) ;
      if ((var_cas_allowedLexicalTypeNameSet.reader_hasKey (_inLexique, operand_2418->mTypeName.reader_string (_inLexique COMMA_SOURCE_FILE_AT_LINE (46)) COMMA_SOURCE_FILE_AT_LINE (46))).isBuiltAndTrue ()) {
        var_cas_lexicalAttributeMap.modifier_insertKey (_inLexique, operand_2418->mName, operand_2418->mTypeName.reader_string (_inLexique COMMA_SOURCE_FILE_AT_LINE (47)) COMMA_SOURCE_FILE_AT_LINE (47)) ;
      }else{
        GGS_string var_cas_m ;
        var_cas_m = GGS_string (true, "") ;
        var_cas_m.writeString ("the @") ;
        var_cas_m._dotAssign_operation (operand_2418->mTypeName) ;
        var_cas_m.writeString (" type is not a valid lexical attribute type; are allowed:") ;
        GGS_bool var_cas_firstLoop ;
        var_cas_firstLoop = GGS_bool (true, true) ;
        {
          GGS_stringset::cEnumerator enumerator_2776 (var_cas_allowedLexicalTypeNameSet, true) ;
          const GGS_stringset::cElement * operand_2776 = (GGS_stringset::cElement *) enumerator_2776.nextObject () ;
          if ((operand_2776 != NULL)) {
            bool _foreach_loop_2776 ;
            do{
              macroValidPointer (operand_2776) ;
              var_cas_m.writeString (" @") ;
              var_cas_m._dotAssign_operation (operand_2776->mKey) ;
              operand_2776 = enumerator_2776.nextObject () ;
              _foreach_loop_2776 = ((operand_2776 != NULL)) ;
              if (_foreach_loop_2776) {
                var_cas_m.writeString (",") ;
              }
            }while (_foreach_loop_2776) ;
          }
        }
        operand_2418->mTypeName.reader_location (_inLexique COMMA_HERE).signalGGSSemanticError (_inLexique, var_cas_m COMMA_SOURCE_FILE_AT_LINE (58)) ;
      }
    }
  }
  GGS_terminalMap  var_cas_terminalMap ;
  var_cas_terminalMap = GGS_terminalMap ::constructor_emptyMap (_inLexique COMMA_HERE) ;
  {
    GGS_terminalDeclarationList::cEnumerator enumerator_3046 (var_cas_lexiqueComponentRoot.reader_mTerminalDeclarationList (_inLexique COMMA_SOURCE_FILE_AT_LINE (63)), true) ;
    const GGS_terminalDeclarationList::cElement * operand_3046 = NULL ;
    while (((operand_3046 = (GGS_terminalDeclarationList::cElement *) enumerator_3046.nextObject ()))) {
      macroValidPointer (operand_3046) ;
      GGS_stringlist  var_cas_argumentTypeList ;
      var_cas_argumentTypeList = GGS_stringlist ::constructor_emptyList (_inLexique COMMA_HERE) ;
      {
        GGS_lstringlist::cEnumerator enumerator_3156 (operand_3046->mSentAttributeList, true) ;
        const GGS_lstringlist::cElement * operand_3156 = NULL ;
        while (((operand_3156 = (GGS_lstringlist::cElement *) enumerator_3156.nextObject ()))) {
          macroValidPointer (operand_3156) ;
          GGS_string var_cas_attributeTypeName ;
          const GGS_lexicalAttributeMap  _temp_3265 = var_cas_lexicalAttributeMap ;
          if (_temp_3265._isBuilt ()) {
            _temp_3265 (HERE)->method_searchKey (_inLexique, operand_3156->mValue, var_cas_attributeTypeName COMMA_SOURCE_FILE_AT_LINE (67)) ;
          }
          var_cas_argumentTypeList._addAssign_operation (var_cas_attributeTypeName) ;
        }
      }
      var_cas_terminalMap.modifier_insertKey (_inLexique, operand_3046->mName, var_cas_argumentTypeList COMMA_SOURCE_FILE_AT_LINE (70)) ;
    }
  }
  {
    GGS_lexicalListDeclarationList::cEnumerator enumerator_3461 (var_cas_lexiqueComponentRoot.reader_mLexicalListDeclarationList (_inLexique COMMA_SOURCE_FILE_AT_LINE (72)), true) ;
    const GGS_lexicalListDeclarationList::cElement * operand_3461 = NULL ;
    while (((operand_3461 = (GGS_lexicalListDeclarationList::cElement *) enumerator_3461.nextObject ()))) {
      macroValidPointer (operand_3461) ;
      GGS_stringlist  var_cas_argumentTypeList ;
      var_cas_argumentTypeList = GGS_stringlist ::constructor_emptyList (_inLexique COMMA_HERE) ;
      {
        GGS_lstringlist::cEnumerator enumerator_3574 (operand_3461->mSentAttributeList, true) ;
        const GGS_lstringlist::cElement * operand_3574 = NULL ;
        while (((operand_3574 = (GGS_lstringlist::cElement *) enumerator_3574.nextObject ()))) {
          macroValidPointer (operand_3574) ;
          GGS_string var_cas_attributeTypeName ;
          const GGS_lexicalAttributeMap  _temp_3683 = var_cas_lexicalAttributeMap ;
          if (_temp_3683._isBuilt ()) {
            _temp_3683 (HERE)->method_searchKey (_inLexique, operand_3574->mValue, var_cas_attributeTypeName COMMA_SOURCE_FILE_AT_LINE (76)) ;
          }
          var_cas_argumentTypeList._addAssign_operation (var_cas_attributeTypeName) ;
        }
      }
      {
        GGS_lexicalListEntryList::cEnumerator enumerator_3808 (operand_3461->mEntryList, true) ;
        const GGS_lexicalListEntryList::cElement * operand_3808 = NULL ;
        while (((operand_3808 = (GGS_lexicalListEntryList::cElement *) enumerator_3808.nextObject ()))) {
          macroValidPointer (operand_3808) ;
          var_cas_terminalMap.modifier_insertKey (_inLexique, operand_3808->mTerminalSpelling, var_cas_argumentTypeList COMMA_SOURCE_FILE_AT_LINE (80)) ;
        }
      }
    }
  }
  #ifdef DEBUG_TRACE_ENABLED
    printf ("LEAVE routine_compileLexiqueComponent\n") ;
  #endif
}

//---------------------------------------------------------------------------*

