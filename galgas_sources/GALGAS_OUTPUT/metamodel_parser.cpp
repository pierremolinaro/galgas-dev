//---------------------------------------------------------------------------*
//                                                                           *
//                       File 'metamodel_parser.cpp'                         *
//         Generated by version GALGAS_BETA_VERSION (LL(1) grammar)          *
//                      april 2nd, 2006, at 17h38'47"                        *
//                                                                           *
//---------------------------------------------------------------------------*

//--- START OF USER ZONE 1


//--- END OF USER ZONE 1

#include "utilities/MF_MemoryControl.h"
#include "files/C_TextFileWrite.h"
#include "metamodel_parser.h"

//---------------------------------------------------------------------------*

#ifndef DO_NOT_GENERATE_CHECKINGS
  static const char gGGSsourceFile [] = "metamodel_parser.ggs" ;
  #define SOURCE_FILE_AT_LINE(line) , gGGSsourceFile, line
#else
  #define SOURCE_FILE_AT_LINE(line) 
#endif


//--- START OF USER ZONE 2


//--- END OF USER ZONE 2

//---------------------------------------------------------------------------*
//                                                                           *
//           Implementation of production rule 'galgas_component'            *
//                                                                           *
//---------------------------------------------------------------------------*

void metamodel_parser::
metamodel_parser::
pr_galgas_component_metamodel_parser_75_24_ (galgas_scanner & lexique_var_,
                                GGS_M_lexiqueComponents  &/* var_cas_ioLexiqueMapForUse */,
                                GGS_M_semanticsComponents  &/* var_cas_ioSemanticsComponentsMap */,
                                GGS_M_syntaxComponents  &/* var_cas_ioSyntaxComponentsMap */,
                                GGS_M_grammarComponents  &/* var_cas_ioGrammarComponentsMap */,
                                GGS_M_optionComponents  &/* var_cas_ioOptionsComponentsMap */,
                                GGS_M_metamodelsComponents  &var_cas_ioMetamodelComponentMap,
                                GGS_M_constraintComponents  &/* var_cas_ioConstraintComponentMap */) {
  nt_parse_metamodel_ (lexique_var_, var_cas_ioMetamodelComponentMap) ;
}

//---------------------------------------------------------------------------*

void metamodel_parser::
metamodel_parser::
pr_galgas_component_metamodel_parser_75_24_importLexique (galgas_scanner & lexique_var_,
                                GGS_M_lexiqueComponents  &/* var_cas_ioLexiqueMapForUse */) {
  nt_parse_metamodel_parse (lexique_var_) ;
}

//---------------------------------------------------------------------------*

void metamodel_parser::
metamodel_parser::
pr_galgas_component_metamodel_parser_75_24_importSyntax (galgas_scanner & lexique_var_,
                                GGS_M_syntaxComponents  &/* var_cas_ioSyntaxComponentsMap */,
                                GGS_M_metamodelsComponents  &var_cas_ioMetamodelComponentMap) {
  nt_parse_metamodel_ (lexique_var_, var_cas_ioMetamodelComponentMap) ;
}

//---------------------------------------------------------------------------*

void metamodel_parser::
metamodel_parser::
pr_galgas_component_metamodel_parser_75_24_importSemantics (galgas_scanner & lexique_var_,
                                GGS_M_semanticsComponents  &/* var_cas_ioSemanticsComponentsMap */,
                                GGS_M_metamodelsComponents  &var_cas_ioMetamodelComponentMap,
                                GGS_M_constraintComponents  &/* var_cas_ioConstraintComponentMap */) {
  nt_parse_metamodel_ (lexique_var_, var_cas_ioMetamodelComponentMap) ;
}

//---------------------------------------------------------------------------*

void metamodel_parser::
metamodel_parser::
pr_galgas_component_metamodel_parser_75_24_importGrammarForSemantics (galgas_scanner & lexique_var_,
                                GGS_M_grammarComponents  &/* var_cas_ioGrammarComponentsMap */,
                                GGS_M_metamodelsComponents  &var_cas_ioMetamodelComponentMap,
                                GGS_M_constraintComponents  &/* var_cas_ioConstraintComponentMap */) {
  nt_parse_metamodel_ (lexique_var_, var_cas_ioMetamodelComponentMap) ;
}

//---------------------------------------------------------------------------*

void metamodel_parser::
metamodel_parser::
pr_galgas_component_metamodel_parser_75_24_importOptions (galgas_scanner & lexique_var_,
                                GGS_M_optionComponents  &/* var_cas_ioOptionsComponentsMap */) {
  nt_parse_metamodel_parse (lexique_var_) ;
}

//---------------------------------------------------------------------------*
//                                                                           *
//           Implementation of production rule 'parse_metamodel'             *
//                                                                           *
//---------------------------------------------------------------------------*

void metamodel_parser::
metamodel_parser::
pr_parse_metamodel_metamodel_parser_114_23_ (galgas_scanner & lexique_var_,
                                GGS_M_metamodelsComponents  &var_cas_ioMetamodelComponentMap) {
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_metamodel) ;
  GGS_lstring  var_cas_metamodelName ;
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_identifier) ;
  var_cas_metamodelName.defineAttribute (lexique_var_.tokenString, lexique_var_) ;
  GGS_stringset  var_cas_primitiveTypeAttributeNameSet ;
  var_cas_primitiveTypeAttributeNameSet = GGS_stringset::constructor_empty (HERE) ;
  var_cas_primitiveTypeAttributeNameSet.addAssign_operation (GGS_string (true, "bool")) ;
  var_cas_primitiveTypeAttributeNameSet.addAssign_operation (GGS_string (true, "char")) ;
  var_cas_primitiveTypeAttributeNameSet.addAssign_operation (GGS_string (true, "uint")) ;
  var_cas_primitiveTypeAttributeNameSet.addAssign_operation (GGS_string (true, "sint")) ;
  var_cas_primitiveTypeAttributeNameSet.addAssign_operation (GGS_string (true, "double")) ;
  var_cas_primitiveTypeAttributeNameSet.addAssign_operation (GGS_string (true, "string")) ;
  var_cas_primitiveTypeAttributeNameSet.addAssign_operation (GGS_string (true, "lbool")) ;
  var_cas_primitiveTypeAttributeNameSet.addAssign_operation (GGS_string (true, "lchar")) ;
  var_cas_primitiveTypeAttributeNameSet.addAssign_operation (GGS_string (true, "luint")) ;
  var_cas_primitiveTypeAttributeNameSet.addAssign_operation (GGS_string (true, "lsint")) ;
  var_cas_primitiveTypeAttributeNameSet.addAssign_operation (GGS_string (true, "ldouble")) ;
  var_cas_primitiveTypeAttributeNameSet.addAssign_operation (GGS_string (true, "lstring")) ;
  var_cas_primitiveTypeAttributeNameSet.addAssign_operation (GGS_string (true, "location")) ;
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_root) ;
  GGS_lstring  var_cas_rootEntityName ;
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_type_5Fname) ;
  var_cas_rootEntityName.defineAttribute (lexique_var_.tokenString, lexique_var_) ;
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1__3A) ;
  GGS_entityToImplementMap  var_cas_entityMap ;
  var_cas_entityMap = GGS_entityToImplementMap::constructor_empty (HERE) ;
  GGS_mapAndEntityUniqueMap  var_cas_mapAndEntityUniqueMap ;
  var_cas_mapAndEntityUniqueMap = GGS_mapAndEntityUniqueMap::constructor_empty (HERE) ;
  nt_entity_declaration_list_ (lexique_var_, var_cas_entityMap, var_cas_primitiveTypeAttributeNameSet, var_cas_mapAndEntityUniqueMap) ;
  GGS_bool var_cas_isAbstract ;
  GGS_entityPropertyMap  var_cas_5848 ;
  GGS_entityPropertyMap  var_cas_5863 ;
  GGS_lstring  var_cas_5866 ;
  var_cas_entityMap.methode_searchKey (lexique_var_, var_cas_rootEntityName, var_cas_5848, var_cas_isAbstract, var_cas_5863, var_cas_5866 SOURCE_FILE_AT_LINE (149)) ;
  if ((var_cas_isAbstract).isBuiltAndTrue ()) {
      var_cas_rootEntityName.reader_location ().signalGGSSemanticError (lexique_var_, GGS_string (true, "the root entity cannot be abstract") SOURCE_FILE_AT_LINE (151)) ;
  }
  GGS_M_semanticsEntitiesForUse  var_cas_semanticsEntityMap ;
  var_cas_semanticsEntityMap = GGS_M_semanticsEntitiesForUse::constructor_empty (HERE) ;
  GGS_entityToImplementMap::element_type * operand_6078 = var_cas_entityMap.firstObject () ;
  while ((operand_6078 != NULL)) {
    macroValidPointer (operand_6078) ;
    GGS_stringset  var_cas_superEntitySet ;
    var_cas_superEntitySet = GGS_stringset::constructor_empty (HERE) ;
    ::routine_buildSuperEntitySet (lexique_var_,  var_cas_entityMap,  operand_6078->mInfo.mSuperEntityName,  var_cas_superEntitySet SOURCE_FILE_AT_LINE (161)) ;
    GGS_AC_galgasType  var_cas_t ;
    var_cas_t = GGS_typeGalgas_singleEntity::constructor_new (operand_6078->mKey, operand_6078->mInfo.mAllPropertiesMap, operand_6078->mInfo.mIsAbstract, operand_6078->mInfo.mEntityPropertiesMap, operand_6078->mInfo.mSuperEntityName, var_cas_superEntitySet COMMA_HERE) ;
    GGS_AC_semanticsEntity  var_cas_e ;
    var_cas_e = GGS_typeEntiteType::constructor_new (var_cas_t COMMA_HERE) ;
    var_cas_semanticsEntityMap.methode_insertKey (lexique_var_, operand_6078->mKey, var_cas_e SOURCE_FILE_AT_LINE (172)) ;
    operand_6078 = operand_6078->nextObject () ;
  }
  GGS_stringset  var_cas_multiReferencedEntities ;
  var_cas_multiReferencedEntities = GGS_stringset::constructor_empty (HERE) ;
  GGS_entityToImplementMap::element_type * operand_6861 = var_cas_entityMap.firstObject () ;
  while ((operand_6861 != NULL)) {
    macroValidPointer (operand_6861) ;
    GGS_entityPropertyMap::element_type * operand_7094 = operand_6861->mInfo.mEntityPropertiesMap.firstObject () ;
    while ((operand_7094 != NULL)) {
      macroValidPointer (operand_7094) ;
      if (((((operand_7094->mInfo.mKind) == (GGS_metamodelPropertyKind::constructor_singleReferenceProperty (HERE))) || ((operand_7094->mInfo.mKind) == (GGS_metamodelPropertyKind::constructor_multipleReferenceProperty (HERE))))).isBuiltAndTrue ()) {
        GGS_entityPropertyMap  var_cas_7436 ;
        GGS_bool var_cas_7439 ;
        GGS_entityPropertyMap  var_cas_7442 ;
        GGS_lstring  var_cas_7445 ;
        var_cas_entityMap.methode_searchKey (lexique_var_, operand_7094->mInfo.mTypeName, var_cas_7436, var_cas_7439, var_cas_7442, var_cas_7445 SOURCE_FILE_AT_LINE (188)) ;
        var_cas_multiReferencedEntities.addAssign_operation (operand_7094->mInfo.mTypeName.reader_value ()) ;
      }
      operand_7094 = operand_7094->nextObject () ;
    }
    operand_6861 = operand_6861->nextObject () ;
  }
  if (var_cas_entityMap.isBuilt () &&
      var_cas_metamodelName.isBuilt () &&
      var_cas_multiReferencedEntities.isBuilt () &&
      var_cas_rootEntityName.isBuilt ()) {
    ::routine_generate_metamodel (lexique_var_,  var_cas_entityMap,  var_cas_metamodelName,  var_cas_multiReferencedEntities,  var_cas_rootEntityName SOURCE_FILE_AT_LINE (195)) ;
  }
  if (((! (var_cas_ioMetamodelComponentMap.reader_hasKey (var_cas_metamodelName.reader_value ())))).isBuiltAndTrue ()) {
    var_cas_ioMetamodelComponentMap.methode_insertKey (lexique_var_, var_cas_metamodelName, var_cas_rootEntityName, var_cas_semanticsEntityMap, var_cas_entityMap, var_cas_multiReferencedEntities SOURCE_FILE_AT_LINE (203)) ;
  }
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_end) ;
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_metamodel) ;
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1__3B) ;
}

//---------------------------------------------------------------------------*

void metamodel_parser::
pr_parse_metamodel_metamodel_parser_114_23_parse (galgas_scanner & lexique_var_) {
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_metamodel) ;
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_identifier) ;
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_root) ;
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_type_5Fname) ;
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1__3A) ;
  nt_entity_declaration_list_parse (lexique_var_) ;
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_end) ;
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_metamodel) ;
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1__3B) ;
}

//---------------------------------------------------------------------------*
//                                                                           *
//       Implementation of production rule 'entity_declaration_list'         *
//                                                                           *
//---------------------------------------------------------------------------*

void metamodel_parser::
metamodel_parser::
pr_entity_declaration_list_metamodel_parser_217_31_ (galgas_scanner & lexique_var_,
                                GGS_entityToImplementMap  &var_cas_outEntityMap,
                                GGS_stringset  &var_cas_ioPrimitiveTypeAttributeNameSet,
                                GGS_mapAndEntityUniqueMap  &var_cas_ioMapAndEntityUniqueMap) {
  { bool syntaxRepeat = true ;
    while (syntaxRepeat) {
      switch (select_repeat_metamodel_parser_0 (lexique_var_)) {
        case 2 : {
          nt_entity_declaration_ (lexique_var_, var_cas_outEntityMap, var_cas_ioPrimitiveTypeAttributeNameSet, var_cas_ioMapAndEntityUniqueMap) ;
          } break ;
        default :
          syntaxRepeat = false ;
          break ;
      }
    }
  }
}

//---------------------------------------------------------------------------*

void metamodel_parser::
pr_entity_declaration_list_metamodel_parser_217_31_parse (galgas_scanner & lexique_var_) {
  { bool syntaxRepeat = true ;
    while (syntaxRepeat) {
      switch (select_repeat_metamodel_parser_0 (lexique_var_)) {
        case 2 : {
          nt_entity_declaration_parse (lexique_var_) ;
          } break ;
        default :
          syntaxRepeat = false ;
          break ;
      }
    }
  }
}

//---------------------------------------------------------------------------*
//                                                                           *
//          Implementation of production rule 'entity_declaration'           *
//                                                                           *
//---------------------------------------------------------------------------*

void metamodel_parser::
metamodel_parser::
pr_entity_declaration_metamodel_parser_234_26_ (galgas_scanner & lexique_var_,
                                GGS_entityToImplementMap  &var_cas_ioEntityMap,
                                GGS_stringset  &var_cas_ioPrimitiveTypeAttributeNameSet,
                                GGS_mapAndEntityUniqueMap  &var_cas_ioMapAndEntityUniqueMap) {
  GGS_bool var_cas_isAbstract ;
  switch (select_metamodel_parser_1 (lexique_var_)) {
    case 1 : {
      var_cas_isAbstract = GGS_bool (true, false) ;
      } break ;
    case 2 : {
      lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_abstract) ;
      var_cas_isAbstract = GGS_bool (true, true) ;
      } break ;
    default :
      break ;
  }
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_entity) ;
  GGS_lstring  var_cas_entityName ;
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_type_5Fname) ;
  var_cas_entityName.defineAttribute (lexique_var_.tokenString, lexique_var_) ;
  var_cas_ioMapAndEntityUniqueMap.methode_insertKey (lexique_var_, var_cas_entityName SOURCE_FILE_AT_LINE (251)) ;
  GGS_entityPropertyMap  var_cas_allPropertyMap ;
  GGS_lstring  var_cas_superEntity ;
  switch (select_metamodel_parser_2 (lexique_var_)) {
    case 1 : {
      var_cas_superEntity = GGS_lstring::constructor_new (GGS_string (true, ""), GGS_location (lexique_var_) COMMA_HERE) ;
      var_cas_allPropertyMap = GGS_entityPropertyMap::constructor_empty (HERE) ;
      } break ;
    case 2 : {
      lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_extends) ;
      lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_type_5Fname) ;
      var_cas_superEntity.defineAttribute (lexique_var_.tokenString, lexique_var_) ;
      GGS_entityPropertyMap  var_cas_9269 ;
      GGS_bool var_cas_9278 ;
      GGS_lstring  var_cas_9309 ;
      var_cas_ioEntityMap.methode_searchKey (lexique_var_, var_cas_superEntity, var_cas_9269, var_cas_9278, var_cas_allPropertyMap, var_cas_9309 SOURCE_FILE_AT_LINE (262)) ;
      } break ;
    default :
      break ;
  }
  GGS_entityPropertyMap  var_cas_entityPropertyMap ;
  var_cas_entityPropertyMap = GGS_entityPropertyMap::constructor_empty (HERE) ;
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1__7B) ;
  { bool syntaxRepeat = true ;
    while (syntaxRepeat) {
      switch (select_repeat_metamodel_parser_3 (lexique_var_)) {
        case 2 : {
          GGS_lstring  var_cas_propertyTypeName ;
          lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_type_5Fname) ;
          var_cas_propertyTypeName.defineAttribute (lexique_var_.tokenString, lexique_var_) ;
          GGS_metamodelPropertyKind var_cas_k ;
          GGS_lstring  var_cas_attributeName ;
          switch (select_metamodel_parser_4 (lexique_var_)) {
            case 1 : {
              lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1__5B) ;
              lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1__5D) ;
              if ((var_cas_ioPrimitiveTypeAttributeNameSet.reader_hasKey (var_cas_propertyTypeName.reader_value ())).isBuiltAndTrue ()) {
                  var_cas_propertyTypeName.reader_location ().signalGGSSemanticError (lexique_var_, ((((GGS_string (true, "the '@")) + (var_cas_propertyTypeName.reader_value ()))) + (GGS_string (true, "' is not an entity name, but a predefined type name"))) SOURCE_FILE_AT_LINE (284)) ;
              }
              lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_identifier) ;
              var_cas_attributeName.defineAttribute (lexique_var_.tokenString, lexique_var_) ;
              var_cas_k = GGS_metamodelPropertyKind::constructor_multipleReferenceProperty (HERE) ;
              } break ;
            case 2 : {
              lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_identifier) ;
              var_cas_attributeName.defineAttribute (lexique_var_.tokenString, lexique_var_) ;
              if ((var_cas_ioPrimitiveTypeAttributeNameSet.reader_hasKey (var_cas_propertyTypeName.reader_value ())).isBuiltAndTrue ()) {
                var_cas_k = GGS_metamodelPropertyKind::constructor_attributeProperty (HERE) ;
              }else{
                var_cas_k = GGS_metamodelPropertyKind::constructor_singleReferenceProperty (HERE) ;
              }
              } break ;
            default :
              break ;
          }
          var_cas_entityPropertyMap.methode_insertKey (lexique_var_, var_cas_attributeName, var_cas_k, var_cas_propertyTypeName SOURCE_FILE_AT_LINE (299)) ;
          var_cas_allPropertyMap.methode_insertKey (lexique_var_, var_cas_attributeName, var_cas_k, var_cas_propertyTypeName SOURCE_FILE_AT_LINE (300)) ;
          lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1__3B) ;
          } break ;
        default :
          syntaxRepeat = false ;
          break ;
      }
    }
  }
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1__7D) ;
  var_cas_ioEntityMap.methode_insertKey (lexique_var_, var_cas_entityName, var_cas_allPropertyMap, var_cas_isAbstract, var_cas_entityPropertyMap, var_cas_superEntity SOURCE_FILE_AT_LINE (305)) ;
}

//---------------------------------------------------------------------------*

void metamodel_parser::
pr_entity_declaration_metamodel_parser_234_26_parse (galgas_scanner & lexique_var_) {
  switch (select_metamodel_parser_1 (lexique_var_)) {
    case 1 : {
      } break ;
    case 2 : {
      lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_abstract) ;
      } break ;
    default :
      break ;
  }
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_entity) ;
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_type_5Fname) ;
  switch (select_metamodel_parser_2 (lexique_var_)) {
    case 1 : {
      } break ;
    case 2 : {
      lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_extends) ;
      lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_type_5Fname) ;
      } break ;
    default :
      break ;
  }
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1__7B) ;
  { bool syntaxRepeat = true ;
    while (syntaxRepeat) {
      switch (select_repeat_metamodel_parser_3 (lexique_var_)) {
        case 2 : {
          lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_type_5Fname) ;
          switch (select_metamodel_parser_4 (lexique_var_)) {
            case 1 : {
              lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1__5B) ;
              lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1__5D) ;
              lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_identifier) ;
              } break ;
            case 2 : {
              lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1_identifier) ;
              } break ;
            default :
              break ;
          }
          lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1__3B) ;
          } break ;
        default :
          syntaxRepeat = false ;
          break ;
      }
    }
  }
  lexique_var_.acceptTerminal (galgas_scanner::galgas_scanner_1__7D) ;
}

//---------------------------------------------------------------------------*

