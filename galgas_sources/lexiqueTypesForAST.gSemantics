#---------------------------------------------------------------------------*
#                                                                           *
#  'lexique' component metamodel                                            *
#                                                                           *
#  Copyright (C) 2007, ..., 2009 Pierre Molinaro.                           *
#                                                                           *
#  e-mail : molinaro@irccyn.ec-nantes.fr                                    *
#                                                                           *
#  This program is free software; you can redistribute it and/or modify it  *
#  under the terms of the GNU General Public License as published by the    *
#  Free Software Foundation.                                                *
#                                                                           *
#  This program is distributed in the hope it will be useful, but WITHOUT   *
#  ANY WARRANTY; without even the implied warranty of MERCHANDIBILITY or    *
#  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for *
#   more details.                                                           *
#                                                                           *
#---------------------------------------------------------------------------*

semantics lexiqueTypesForAST :

#---------------------------------------------------------------------------*

abstract class @lexicalExpressionAST {
}

#---------------------------------------------------------------------------*

abstract class @lexicalInstructionAST {
}

#---------------------------------------------------------------------------*

list @lexicalInstructionListAST {
  @lexicalInstructionAST mInstruction feature nogetter ;
}

#---------------------------------------------------------------------------*

list @metamodelTemplateDelimitorListAST {
  @lstring mStartString feature nogetter ;
  @lstringlist mOptionList feature nogetter ;
  @lstring mEndString feature nogetter ;
}

#---------------------------------------------------------------------------*

list @templateReplacementListAST {
  @lstring mMatchString feature nogetter ;
  @lstring mReplacementString feature nogetter ;
  @lstring mReplacementFunction feature nogetter ;
}

#---------------------------------------------------------------------------*

abstract class @abstractLexicalRuleAST {
}

#---------------------------------------------------------------------------*

list @lexicalRuleListAST {
  @abstractLexicalRuleAST mLexicalRule feature nogetter ;
}

#---------------------------------------------------------------------------*

class @lexicalImplicitRuleAST extends @abstractLexicalRuleAST {
  @lstring mListName ;
}

#---------------------------------------------------------------------------*

class @lexicalExplicitRuleAST extends @abstractLexicalRuleAST {
  @lexicalExpressionAST mLexicalRuleExpression ;
  @lexicalInstructionListAST mInstructionList ;
}

#---------------------------------------------------------------------------*

list @lexicalMessageDeclarationListAST {
  @lstring mMessageName feature nogetter ;
  @lstring mMessageValue feature nogetter ;
}

#---------------------------------------------------------------------------*

list @lexicalAttributeListAST {
  @lstring mTypeName feature nogetter ;
  @lstring mName feature nogetter ;
}

#---------------------------------------------------------------------------*

list @lexicalStyleListAST {
  @lstring mName feature nogetter ;
  @lstring mComment feature nogetter ;
}

#---------------------------------------------------------------------------*

list @terminalDeclarationListAST {
  @lstring mName feature nogetter ;
  @lstringlist mSentAttributeList feature nogetter ;
  @lstring mSyntaxErrorMessage feature nogetter ;
  @lstring mStyle feature nogetter ; # Empty string if no style
  @lstringlist mOptionList feature nogetter ;
}

#---------------------------------------------------------------------------*

list @lexicalListEntryListAST {
  @lstring mEntrySpelling feature nogetter ;
  @lstring mTerminalSpelling feature nogetter ;
  @lstringlist mFeatureList feature nogetter ;
}

#---------------------------------------------------------------------------*

list @lexicalListDeclarationListAST {
  @lstring mName feature nogetter ;
  @lstring mStyle feature nogetter ; # Empty string if no style
  @lstring mSyntaxErrorMessage feature nogetter ;
  @lstringlist mSentAttributeList feature nogetter ;
  @lexicalListEntryListAST mEntryList feature nogetter ;  
}

#---------------------------------------------------------------------------*

class @lexicalOrExpressionAST extends @lexicalExpressionAST {
  @lexicalExpressionAST mLeftOperand ;
  @lexicalExpressionAST mRightOperand ;
}

#---------------------------------------------------------------------------*

class @lexicalCharacterSetMatchAST extends @lexicalExpressionAST {
  @lstring mCharacterSetName ;
}

#---------------------------------------------------------------------------*

class @lexicalCharacterMatchAST extends @lexicalExpressionAST {
  @lchar mCharacter ;
}

#---------------------------------------------------------------------------*

class @lexicalCharacterIntervalMatchAST extends @lexicalExpressionAST {
  @lchar mLowerBound ;
  @lchar mUpperBound ;
}

#---------------------------------------------------------------------------*

class @lexicalStringMatchAST extends @lexicalExpressionAST {
  @lstring mString ;
}

#---------------------------------------------------------------------------*

class @lexicalStringNotMatchAST extends @lexicalExpressionAST {
  @lstring mString ;
  @lstring mErrorMessage ;
}

#---------------------------------------------------------------------------*

list @lexicalSendSearchListAST {
  @lstring mAttributeName feature nogetter ;
  @lstring mSearchListName feature nogetter ;
}

#---------------------------------------------------------------------------*

abstract class @lexicalSendDefaultActionAST {
}

#---------------------------------------------------------------------------*

class @lexicalStructuredSendInstructionAST extends @lexicalInstructionAST {
  @lexicalSendSearchListAST mLexicalSendSearchList ;
  @lexicalSendDefaultActionAST mLexicalSendDefaultAction ;
}

#---------------------------------------------------------------------------*

class @lexicalSimpleSendInstructionAST extends @lexicalInstructionAST {
  @lstring mSentTerminal ;
}

#---------------------------------------------------------------------------*

class @lexicalSendTerminalByDefaultAST extends @lexicalSendDefaultActionAST {
  @lstring mDefaultSentTerminal ;
}

#---------------------------------------------------------------------------*

class @lexicalErrorByDefaultAST extends @lexicalSendDefaultActionAST {
  @lstring mDefaultErrorMessageName ;
}

#---------------------------------------------------------------------------*

list @lexicalWhileBranchListAST {
  @lexicalExpressionAST mWhileExpression feature nogetter ;
  @lexicalInstructionListAST mWhileInstructionList feature nogetter ;
}

#---------------------------------------------------------------------------*

class @lexicalRepeatInstructionAST extends @lexicalInstructionAST {
  @lexicalInstructionListAST mRepeatedInstructionList ;
  @lexicalWhileBranchListAST mLexicalWhileBranchList ;
}

#---------------------------------------------------------------------------*

list @lexicalSelectBranchListAST {
  @lexicalExpressionAST mSelectExpression feature nogetter ;
  @lexicalInstructionListAST mSelectInstructionList feature nogetter ;
}

#---------------------------------------------------------------------------*

class @lexicalSelectInstructionAST extends @lexicalInstructionAST {
  @lexicalSelectBranchListAST mLexicalSelectBranchList ;
  @lexicalInstructionListAST mDefaultInstructionList ;
}

#---------------------------------------------------------------------------*

abstract class @abstractLexicalRoutineActualArgumentAST {
  @location mActualPassingModeLocation ;
}

#---------------------------------------------------------------------------*

list @lexicalRoutineCallActualArgumentListAST {
  @abstractLexicalRoutineActualArgumentAST mLexicalRoutineActualArgument feature nogetter ;
}

#---------------------------------------------------------------------------*

class @lexicalRoutineInstructionAST extends @lexicalInstructionAST {
  @lstring mRoutineName ;
  @lexicalRoutineCallActualArgumentListAST mActualArgumentList ;
  @lstringlist mErrorMessageList ;
}

#---------------------------------------------------------------------------*

class @lexicalAttributeInputOutputArgumentAST extends @abstractLexicalRoutineActualArgumentAST {
  @lstring mAttributeName ;
}

#---------------------------------------------------------------------------*

abstract class @lexicalRoutineOrFunctionFormalInputArgumentAST {
}

#---------------------------------------------------------------------------*

class @lexicalFormalInputArgumentAST extends @abstractLexicalRoutineActualArgumentAST {
  @lexicalRoutineOrFunctionFormalInputArgumentAST mRoutineOrFunctionFormalInputArgument ;
}

#---------------------------------------------------------------------------*

list @lexicalFunctionCallActualArgumentListAST {
  @lexicalRoutineOrFunctionFormalInputArgumentAST mLexicalActualInputArgument feature nogetter ;
}

#---------------------------------------------------------------------------*

class @lexicalAttributeInputArgumentAST extends @lexicalRoutineOrFunctionFormalInputArgumentAST {
  @lstring mAttributeName ;
}

#---------------------------------------------------------------------------*

class @lexicalCharacterInputArgumentAST extends @lexicalRoutineOrFunctionFormalInputArgumentAST {
  @lchar mCharacter ;
}

#---------------------------------------------------------------------------*

class @lexicalUnsignedInputArgumentAST extends @lexicalRoutineOrFunctionFormalInputArgumentAST {
  @luint mUnsigned ;
}

#---------------------------------------------------------------------------*

class @lexicalCurrentCharacterInputArgumentAST extends @lexicalRoutineOrFunctionFormalInputArgumentAST {
  @location mLocation ;
}

#---------------------------------------------------------------------------*

class @lexicalFunctionInputArgumentAST extends @lexicalRoutineOrFunctionFormalInputArgumentAST {
  @lstring mFunctionName ;
  @lexicalFunctionCallActualArgumentListAST mFunctionActualArgumentList ;
}

#---------------------------------------------------------------------------*

class @lexicalDropInstructionAST extends @lexicalInstructionAST {
  @lstring mTerminalName ;
}

#---------------------------------------------------------------------------*

class @lexicalErrorInstructionAST extends @lexicalInstructionAST {
  @lstring mErrorMessageName ;
}

#---------------------------------------------------------------------------*

class @lexicalWarningInstructionAST extends @lexicalInstructionAST {
  @lstring mWarningMessageName ;
}

#---------------------------------------------------------------------------*

class @lexicalTagInstructionAST extends @lexicalInstructionAST {
  @lstring mLexicalTagName ;
}

#---------------------------------------------------------------------------*

class @lexicalRewindInstructionAST extends @lexicalInstructionAST {
  @lstring mLexicalTagName ;
  @lstring mTerminalName ;
}

#---------------------------------------------------------------------------*

class @lexicalLogInstructionAST extends @lexicalInstructionAST {
}

#---------------------------------------------------------------------------*

enum @lexicalArgumentModeAST {
  lexicalInputMode, lexicalInputOutputMode
}

reader @lexicalArgumentModeAST lexicalFormalModeName -> @string outResult :
  switch selfcopy
  when lexicalInputMode       : outResult := "!" ;
  when lexicalInputOutputMode : outResult := "?!" ;
  end switch ;
end reader ;

reader @lexicalArgumentModeAST cppConstInFormalArgument -> @string outResult :
  switch selfcopy
  when lexicalInputMode       : outResult := "const " ;
  when lexicalInputOutputMode : outResult := "" ;
  end switch ;
end reader ;

reader @lexicalArgumentModeAST cppReferenceInFormalArgument -> @string outResult :
  switch selfcopy
  when lexicalInputMode       : outResult := "" ;
  when lexicalInputOutputMode : outResult := " &" ;
  end switch ;
end reader ;

reader @lexicalArgumentModeAST cocoaPointerInFormalArgument -> @string outResult :
  switch selfcopy
  when lexicalInputMode       : outResult := "" ;
  when lexicalInputOutputMode : outResult := " *" ;
  end switch ;
end reader ;

#---------------------------------------------------------------------------*

list @lexicalExternRoutineFormalArgumentListAST {
  @lexicalArgumentModeAST mPassingMode feature nogetter ;
  @lstring mLexicalTypeName feature nogetter ;
  @lstring mFormalArgumentName feature nogetter ;
}

#---------------------------------------------------------------------------*

list @externRoutineListAST {
  @lstring mRoutineName feature nogetter ;
  @lexicalExternRoutineFormalArgumentListAST mLexicalRoutineFormalArgumentList feature nogetter ;
  @stringlist mErrorMessageList feature nogetter ;
}

#---------------------------------------------------------------------------*

list @lexicalExternFunctionFormalArgumentListAST {
  @lstring mLexicalTypeName feature nogetter ;
  @lstring mFormalArgumentName feature nogetter ;
}

#---------------------------------------------------------------------------*

list @externFunctionListAST {
  @lstring mFunctionName feature nogetter ;
  @lexicalExternFunctionFormalArgumentListAST mLexicalFunctionFormalArgumentList feature nogetter ;
  @lstring mReturnedTypeName feature nogetter ;
}

#---------------------------------------------------------------------------*

list @indexingListAST {
  @lstring mIndexName feature nogetter ;
  @lstring mIndexComment feature nogetter ;
}

#---------------------------------------------------------------------------*

struct @lexiqueComponentAST {
  @lstring mLexiqueComponentName  ;
  @bool mIsTemplate ;
  @metamodelTemplateDelimitorListAST mTemplateDelimitorList ;
  @templateReplacementListAST mTemplateReplacementList ;
  @lexicalAttributeListAST mLexicalAttributeList ;
  @lexicalStyleListAST mLexicalStyleList ;
  @terminalDeclarationListAST mTerminalDeclarationList  ;
  @lexicalMessageDeclarationListAST mLexicalMessageDeclarationList ;
  @lexicalListDeclarationListAST mLexicalListDeclarationList  ;
  @lexicalRuleListAST mLexicalRuleList ;
  @externRoutineListAST mExternRoutineList ;
  @externFunctionListAST mExternFunctionList  ;
  @indexingListAST mIndexingListAST ;
  @lstring mIndexingDirectory ;
}

#---------------------------------------------------------------------------*

end semantics ;