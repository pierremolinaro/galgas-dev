#---------------------------------------------------------------------------*
#                                                                           *
#  metamodel that defines expression                                        *
#                                                                           *
#  Copyright (C) 2007, ..., 2010 Pierre Molinaro.                           *
#                                                                           *
#  e-mail : molinaro@irccyn.ec-nantes.fr                                    *
#                                                                           *
#  This program is free software; you can redistribute it and/or modify it  *
#  under the terms of the GNU General Public License as published by the    *
#  Free Software Foundation.                                                *
#                                                                           *
#  This program is distributed in the hope it will be useful, but WITHOUT   *
#  ANY WARRANTY; without even the implied warranty of MERCHANDIBILITY or    *
#  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for *
#   more details.                                                           *
#                                                                           *
#---------------------------------------------------------------------------*

semantics semanticsDecoratedTypes :
  import "semanticContext.gSemantics" ;

  import semantics semanticContext in "semanticContext.gSemantics" ;

#---------------------------------------------------------------------------*

abstract class @templateInstructionForGeneration {
}

#---------------------------------------------------------------------------*

list @templateInstructionListForGeneration {
  @templateInstructionForGeneration mInstruction ;
}

#---------------------------------------------------------------------------*

abstract class @semanticExpressionForGeneration {
  @unifiedTypeMapProxy mType ;
  @location mLocation ;
}

#---------------------------------------------------------------------------*

list @semanticExpressionListForGeneration {
  @semanticExpressionForGeneration mExpression ;
}

#---------------------------------------------------------------------------*

class @selfCopyInExpressionForGeneration extends @semanticExpressionForGeneration {
  @string mSelfCppName ;
}

##---------------------------------------------------------------------------*

class @hereExpressionForGeneration extends @semanticExpressionForGeneration {
}

##---------------------------------------------------------------------------*

class @trueExpressionForGeneration extends @semanticExpressionForGeneration {
}

##---------------------------------------------------------------------------*

class @falseExpressionForGeneration extends @semanticExpressionForGeneration {
}

##---------------------------------------------------------------------------*

class @literalCharExpressionForGeneration extends @semanticExpressionForGeneration {
  @char mCharacter ;
}

##---------------------------------------------------------------------------*

class @literalStringExpressionForGeneration extends @semanticExpressionForGeneration {
  @string mString ;
}

##---------------------------------------------------------------------------*

class @literalDoubleExpressionForGeneration extends @semanticExpressionForGeneration {
  @double mValue ;
}

##---------------------------------------------------------------------------*

class @literalUIntExpressionForGeneration extends @semanticExpressionForGeneration {
  @uint mValue ;
}

##---------------------------------------------------------------------------*

class @literalUInt64ExpressionForGeneration extends @semanticExpressionForGeneration {
  @uint64 mValue ;
}

#---------------------------------------------------------------------------*

class @literalSIntExpressionForGeneration extends @semanticExpressionForGeneration {
  @sint mValue ;
}

#---------------------------------------------------------------------------*

class @literalSInt64ExpressionForGeneration extends @semanticExpressionForGeneration {
  @sint64 mValue ;
}

#---------------------------------------------------------------------------*

class @constructorExpressionForGeneration extends @semanticExpressionForGeneration {
  @unifiedTypeMapProxy mConstructorType ;
  @string mConstructorName ;
  @semanticExpressionListForGeneration mEffectiveParameterList ;
  @bool mHasCompilerArgument ;
}

#---------------------------------------------------------------------------*

class @readerCallExpressionForGeneration extends @semanticExpressionForGeneration {
  @bool mIsCategory ;
  @semanticExpressionForGeneration mReceiverExpression ;
  @stringlist mFieldList ;
  @string mReaderName ;
  @semanticExpressionListForGeneration mExpressions ;
  @bool mHasCompilerArgument ;
}

#---------------------------------------------------------------------------*

class @thisReaderCallExpressionForGeneration extends @semanticExpressionForGeneration {
  @bool mIsCategory ;
  @string mReaderName ;
  @semanticExpressionListForGeneration mExpressions ;
  @bool mHasCompilerArgument ;
}

#---------------------------------------------------------------------------*

class @superReaderCallExpressionForGeneration extends @semanticExpressionForGeneration {
  @bool mIsCategory ;
  @string mSuperClassThatImplementsReader ;
  @string mReaderName ;
  @semanticExpressionListForGeneration mExpressions ;
  @bool mHasCompilerArgument ;
}

#---------------------------------------------------------------------------*

class @optionValueExpressionForGeneration extends @semanticExpressionForGeneration {
  @string mOptionComponentName ;
  @string mOptionEntryName ;
}

#---------------------------------------------------------------------------*

class @optionCharExpressionForGeneration extends @semanticExpressionForGeneration {
  @string mOptionComponentName ;
  @string mOptionEntryName ;
}

#---------------------------------------------------------------------------*

class @optionStringExpressionForGeneration extends @semanticExpressionForGeneration {
  @string mOptionComponentName ;
  @string mOptionEntryName ;
}

#---------------------------------------------------------------------------*

class @optionCommentExpressionForGeneration extends @semanticExpressionForGeneration {
  @string mOptionComponentName ;
  @string mOptionEntryName ;
}

#---------------------------------------------------------------------------*

class @concatExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mLeftExpression ;
  @semanticExpressionForGeneration mRightExpression ;
}

#---------------------------------------------------------------------------*

class @orExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mLeftExpression ;
  @semanticExpressionForGeneration mRightExpression ;
}

#---------------------------------------------------------------------------*

class @xorExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mLeftExpression ;
  @semanticExpressionForGeneration mRightExpression ;
}

#---------------------------------------------------------------------------*

class @andExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mLeftExpression ;
  @semanticExpressionForGeneration mRightExpression ;
}

#---------------------------------------------------------------------------*

class @equalExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mLeftExpression ;
  @semanticExpressionForGeneration mRightExpression ;
}

#---------------------------------------------------------------------------*

class @notEqualExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mLeftExpression ;
  @semanticExpressionForGeneration mRightExpression ;
}

#---------------------------------------------------------------------------*

class @lowerOrEqualExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mLeftExpression ;
  @semanticExpressionForGeneration mRightExpression ;
}

#---------------------------------------------------------------------------*

class @greaterOrEqualExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mLeftExpression ;
  @semanticExpressionForGeneration mRightExpression ;
}

#---------------------------------------------------------------------------*

class @strictGreaterExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mLeftExpression ;
  @semanticExpressionForGeneration mRightExpression ;
}

#---------------------------------------------------------------------------*

class @strictLowerExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mLeftExpression ;
  @semanticExpressionForGeneration mRightExpression ;
}

#---------------------------------------------------------------------------*

class @rightShiftExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mLeftExpression ;
  @semanticExpressionForGeneration mRightExpression ;
}

#---------------------------------------------------------------------------*

class @leftShiftExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mLeftExpression ;
  @semanticExpressionForGeneration mRightExpression ;
}

#---------------------------------------------------------------------------*

class @addExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mLeftExpression ;
  @semanticExpressionForGeneration mRightExpression ;
}

#---------------------------------------------------------------------------*

class @subExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mLeftExpression ;
  @semanticExpressionForGeneration mRightExpression ;
}

#---------------------------------------------------------------------------*

class @multiplicationExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mLeftExpression ;
  @semanticExpressionForGeneration mRightExpression ;
}

#---------------------------------------------------------------------------*

class @divisionExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mLeftExpression ;
  @semanticExpressionForGeneration mRightExpression ;
}

#---------------------------------------------------------------------------*

class @moduloExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mLeftExpression ;
  @semanticExpressionForGeneration mRightExpression ;
}

#---------------------------------------------------------------------------*

class @unaryMinusExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mExpression ;
}

#---------------------------------------------------------------------------*

class @notExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mExpression ;
}

#---------------------------------------------------------------------------*

class @tildeExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mExpression ;
}

#---------------------------------------------------------------------------*

class @ifExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mIfExpression ;
  @semanticExpressionForGeneration mThenExpression ;
  @semanticExpressionForGeneration mElseExpression ;
}

#---------------------------------------------------------------------------*

class @functionCallExpressionForGeneration extends @semanticExpressionForGeneration {
  @string mFunctionName ;
  @semanticExpressionListForGeneration mExpressions ;
}

#---------------------------------------------------------------------------*

class @varInExpressionForGeneration extends @semanticExpressionForGeneration {
  @string mCppVarName ;
  @string mNameForCheckingFormalParameterUsing ;
  @lstringlist mStructFieldList ;
}

#---------------------------------------------------------------------------*

class @literalTypeInExpressionForGeneration extends @semanticExpressionForGeneration {
  @string mTypeName ;
}

#---------------------------------------------------------------------------*

class @castInExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mReceiverExpression ;
  @bool mUseKindOfClass ;
  @string mTypeName ;
  @semanticExpressionForGeneration mErrorLocationExpression ;
}

#---------------------------------------------------------------------------*

class @extractObjectInExpressionForGeneration extends @semanticExpressionForGeneration {
  @semanticExpressionForGeneration mReceiverExpression ;
  @string mTypeName ;
  @semanticExpressionForGeneration mErrorLocationExpression ;
}

#---------------------------------------------------------------------------*

class @filewrapperInExpressionForGeneration extends @semanticExpressionForGeneration {
  @string mFilewrapperName ;
  @string mFilewrapperPath ;
}

#---------------------------------------------------------------------------*

class @filewrapperStaticPathInExpressionForGeneration extends @semanticExpressionForGeneration {
  @string mFilewrapperName ;
  @uint mFilewrapperFileIndex ;
}

#---------------------------------------------------------------------------*

class @filewrapperTemplateInExpressionForGeneration extends @semanticExpressionForGeneration {
  @string mFilewrapperName ;
  @string mFilewrapperTemplateName ;
  @semanticExpressionListForGeneration mActualOutputParameterList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  F O R M A L    P A R A M E T E R    L I S T                              *
#                                                                           *
#---------------------------------------------------------------------------*

list @formalParameterListForGeneration {
  @formalArgumentPassingModeAST mFormalArgumentPassingMode ;
  @unifiedTypeMapProxy mFormalArgumentType ;
  @lstring mFormalArgumentName ;
  @string mFormalArgumentCppName ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  F O R M A L    I N P U T    P A R A M E T E R    L I S T                 *
#                                                                           *
#---------------------------------------------------------------------------*

list @formalInputParameterListForGeneration {
  @unifiedTypeMapProxy mFormalArgumentType ;
  @string mFormalArgumentCppName ;
  @lstring mFormalArgumentName ;
  @bool mIsUnused ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  A C T U A L    P A R A M E T E R                                         *
#                                                                           *
#---------------------------------------------------------------------------*

abstract class @actualParameterForGeneration {
}

#---------------------------------------------------------------------------*

class @outputActualParameterForGeneration extends @actualParameterForGeneration {
  @semanticExpressionForGeneration mOutputActualParameterExpression ;
}

#---------------------------------------------------------------------------*

class @outputInputActualParameterForGeneration extends @actualParameterForGeneration {
  @string mOutputInputVariableCppName ;
  @lstringlist mStructAttributeList ;
}

#---------------------------------------------------------------------------*

class @inputActualParameterForGeneration extends @actualParameterForGeneration {
  @string mInputActualCppName ;
}

#---------------------------------------------------------------------------*

class @inputJokerParameterForGeneration extends @actualParameterForGeneration {
  @string mInputActualCppName ;
  @unifiedTypeMapProxy mFormalArgumentType ;
}

#---------------------------------------------------------------------------*

list @actualParameterListForGeneration {
  @actualParameterForGeneration mActualParameter ;
}

#---------------------------------------------------------------------------*

abstract class @semanticInstructionForGeneration {
}

#---------------------------------------------------------------------------*

list @semanticInstructionListForGeneration {
  @semanticInstructionForGeneration mInstruction ;
}

#---------------------------------------------------------------------------*

list @listOfSemanticInstructionListForGeneration {
  @semanticInstructionListForGeneration mInstructionList ;
  @location mEndOfInstructionList ;
}

#---------------------------------------------------------------------------*

abstract class @semanticDeclarationForGeneration {
}

#---------------------------------------------------------------------------*

sortedlist @semanticDeclarationSortedListForGeneration {
  @semanticDeclarationForGeneration mDeclaration ;
  @string mSortKey ;
}{
  mSortKey <
}

#---------------------------------------------------------------------------*
#                                                                           *
#    T Y P E    D E C L A R A T I O N                                       *
#                                                                           *
#---------------------------------------------------------------------------*

abstract class @semanticTypeForGeneration extends @semanticDeclarationForGeneration {
  @unifiedTypeMapProxy mTypeIndex ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    R O U T I N E    D E C L A R A T I O N                                 *
#                                                                           *
#---------------------------------------------------------------------------*

class @routinePrototypeDeclarationForGeneration extends @semanticDeclarationForGeneration {
  @string mRoutineName ;
  @formalParameterListForGeneration mFormalArgumentList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    R O U T I N E    I M P L E M E N T A T I O N                           *
#                                                                           *
#---------------------------------------------------------------------------*

class @routineImplementationForGeneration extends @routinePrototypeDeclarationForGeneration {
  @semanticInstructionListForGeneration mRoutineInstructionList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    F U N C T I O N    D E C L A R A T I O N                               *
#                                                                           *
#---------------------------------------------------------------------------*

class @functionPrototypeDeclarationForGeneration extends @semanticDeclarationForGeneration {
  @string mFunctionName ;
  @formalInputParameterListForGeneration mFormalArgumentList ;
  @unifiedTypeMapProxy mReturnType ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    F U N C T I O N    I M P L E M E N T A T I O N                         *
#                                                                           *
#---------------------------------------------------------------------------*

class @functionImplementationForGeneration extends @functionPrototypeDeclarationForGeneration {
  @string mResultVariableCppName ;
  @semanticInstructionListForGeneration mFunctionInstructionList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    O N C E    F U N C T I O N    D E C L A R A T I O N                    *
#                                                                           *
#---------------------------------------------------------------------------*

class @onceFunctionDeclarationForGeneration extends @semanticDeclarationForGeneration {
  @string mFunctionName ;
  @unifiedTypeMapProxy mReturnType ;
  @string mResultVariableCppName ;
  @semanticInstructionListForGeneration mFunctionInstructionList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  L O C A L    V A R I A B L E    D E C L A R A T I O N                    *
#                                                                           *
#---------------------------------------------------------------------------*

class @localVariableDeclarationForGeneration extends @semanticInstructionForGeneration {
  @unifiedTypeMapProxy mVariableType ;
  @string mCppVariableName ;
}

#---------------------------------------------------------------------------*

class @localVariableOrConstantDeclarationWithSourceExpressionForGeneration extends @semanticInstructionForGeneration {
  @unifiedTypeMapProxy mTargetType ;
  @bool mIsConstant ;
  @string mCppVariableName ;
  @semanticExpressionForGeneration mSourceExpression ;
}

#---------------------------------------------------------------------------*

class @localVariableOrConstantDeclarationWithConstructorCallForGeneration extends @semanticInstructionForGeneration {
  @location mInstructionLocation ;
  @unifiedTypeMapProxy mTargetType ;
  @bool mIsConstant ;
  @string mTargetVariableCppName ;
  @string mConstructorName ;
  @semanticExpressionListForGeneration mConstructorArguments ;
  @bool mHasCompilerArgument ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  A S S I G N M E N T    I N S T R U C T I O N                             *
#                                                                           *
#---------------------------------------------------------------------------*

class @assignmentInstructionForGeneration extends @semanticInstructionForGeneration {
  @unifiedTypeMapProxy mTargetType ;
  @string mTargetCppName ;
  @lstringlist mStructAttributeList ;
  @semanticExpressionForGeneration mSourceExpression ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  D R O P    I N S T R U C T I O N                                         *
#                                                                           *
#---------------------------------------------------------------------------*

class @dropInstructionForGeneration extends @semanticInstructionForGeneration {
  @stringlist mDropList ;
  @string mComment ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  D O T    A S S I G N M E N T    I N S T R U C T I O N                    *
#                                                                           *
#  VARIABLE .= EXPRESSION ;                                                 *
#                                                                           *
#---------------------------------------------------------------------------*

class @appendInstructionForGeneration extends @semanticInstructionForGeneration {
  @location mInstructionLocation ;
  @unifiedTypeMapProxy mTargetType ;
  @string mTargetVariableCppName ;
  @lstringlist mStructAttributeList ;
  @semanticExpressionForGeneration mSourceExpression ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  S E N D    I N S T R U C T I O N                                         *
#                                                                           *
#  send EXPRESSION ;                                                        *
#                                                                           *
#---------------------------------------------------------------------------*

class @sendInstructionForGeneration extends @semanticInstructionForGeneration {
  @semanticExpressionForGeneration mSourceExpression ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  F O R E A C H    I N S T R U C T I O N                                   *
#                                                                           *
#---------------------------------------------------------------------------*

#abstract class @foreachInstructionEnumeratedObjectElementForGeneration {
#}

#---------------------------------------------------------------------------*

#class @foreachInstructionJokerForGeneration extends @foreachInstructionEnumeratedObjectElementForGeneration {
#}

#---------------------------------------------------------------------------*

#class @foreachInstructionEnumeratedConstantForGeneration extends @foreachInstructionEnumeratedObjectElementForGeneration {
#  @lstring mTypeName ;
#  @lstring mConstantName ;
#}

#---------------------------------------------------------------------------*

#list @foreachInstructionEnumeratedObjectElementListForGeneration {
#  @foreachInstructionEnumeratedObjectElementForGeneration mElement ;
#}

#---------------------------------------------------------------------------*

list @foreachInstructionEnumeratedObjectListForGeneration {
  @bool mIsAscending ;
  @semanticExpressionForGeneration mEnumeratedExpression ;
  @string mEnumeratorCppName ;
}

#---------------------------------------------------------------------------*

class @foreachInstructionForGeneration extends @semanticInstructionForGeneration {
  @location mInstructionLocation ;
  @foreachInstructionEnumeratedObjectListForGeneration mEnumeratedObjectList ;
  @string mIndexVariableCppName ;  # Empty string if no index
  @semanticExpressionForGeneration mWhileExpression ;
  @semanticInstructionListForGeneration mBeforeInstructionList ;
  @semanticInstructionListForGeneration mBetweenInstructionList ;
  @semanticInstructionListForGeneration mDoInstructionList ;
  @semanticInstructionListForGeneration mAfterInstructionList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  I F    I N S T R U C T I O N                                             *
#                                                                           *
#---------------------------------------------------------------------------*

class @ifInstructionForGeneration extends @semanticInstructionForGeneration {
  @location mInstructionLocation ;
  @semanticExpressionForGeneration mIFexpression ;
  @semanticInstructionListForGeneration m_then_instructionList ;
  @semanticInstructionListForGeneration m_else_instructionList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    E R R O R    I N S T R U C T I O N                                     *
#                                                                           *
#---------------------------------------------------------------------------*

class @errorInstructionForGeneration extends @semanticInstructionForGeneration {
  @location mInstructionLocation ;
  @semanticExpressionForGeneration mReceiverExpression ;
  @bool mUseLocationReader ;
  @semanticExpressionForGeneration mErrorExpression ;
  @stringlist mBuiltVariableCppNameList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    W A R N I N G    I N S T R U C T I O N                                 *
#                                                                           *
#---------------------------------------------------------------------------*

class @warningInstructionForGeneration extends @semanticInstructionForGeneration {
  @location mInstructionLocation ;
  @semanticExpressionForGeneration mReceiverExpression ;
  @bool mUseLocationReader ;
  @semanticExpressionForGeneration mWarningExpression ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    R O U T I N E    C A L L    I N S T R U C T I O N                      *
#                                                                           *
#---------------------------------------------------------------------------*

class @routineCallInstructionForGeneration extends @semanticInstructionForGeneration {
  @lstring mRoutineName ;
  @actualParameterListForGeneration mActualParameterList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  T Y P E    M E T H O D    C A L L    I N S T R U C T I O N               *
#                                                                           *
#---------------------------------------------------------------------------*

class @typeMethodInstructionForGeneration extends @semanticInstructionForGeneration {
  @lstring mTypeName ;
  @lstring mMethodName ;
  @actualParameterListForGeneration mActualParameterList ;
  @bool mHasCompilerArgument ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  M E T H O D    C A L L    I N S T R U C T I O N                          *
#                                                                           *
#---------------------------------------------------------------------------*

class @methodCallInstructionForGeneration extends @semanticInstructionForGeneration {
  @location mInstructionLocation ;
  @semanticExpressionForGeneration mReceiverExpression ;
  @string mMethodName ;
  @bool mIsCategory ;
  @actualParameterListForGeneration mActualParameterList ;
  @bool mHasCompilerArgument ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  " T H I S "    M E T H O D    C A L L    I N S T R U C T I O N           *
#                                                                           *
#---------------------------------------------------------------------------*

class @thisMethodCallInstructionForGeneration extends @semanticInstructionForGeneration {
  @string mCurrentObjectCppPointer ;
  @location mInstructionLocation ;
  @string mMethodName ;
  @bool mIsCategory ;
  @actualParameterListForGeneration mActualParameterList ;
  @bool mHasCompilerArgument ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  " S U P E R "    M E T H O D    C A L L    I N S T R U C T I O N         *
#                                                                           *
#---------------------------------------------------------------------------*

class @superMethodCallInstructionForGeneration extends @semanticInstructionForGeneration {
  @location mInstructionLocation ;
  @string mSuperClassThatImplementsMethod ;
  @string mMethodName ;
  @bool mIsCategory ;
  @actualParameterListForGeneration mActualParameterList ;
  @bool mHasCompilerArgument ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  M O D I F I E R    C A L L    I N S T R U C T I O N                      *
#                                                                           *
#---------------------------------------------------------------------------*

class @modifierCallInstructionForGeneration extends @semanticInstructionForGeneration {
  @string mReceiverCppName ;
  @lstringlist mReceiverStructAttributes ;
  @unifiedTypeMapProxy mReceiverType ;
  @lstring mModifierName ;
  @actualParameterListForGeneration mActualParameterList ;
  @bool mHasCompilerArgument ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  " T H I S "    M O D I F I E R    C A L L    I N S T R U C T I O N       *
#                                                                           *
#---------------------------------------------------------------------------*

class @thisModifierCallInstructionForGeneration extends @semanticInstructionForGeneration {
  @unifiedTypeMapProxy mReceiverType ;
  @lstring mModifierName ;
  @actualParameterListForGeneration mActualParameterList ;
  @bool mHasCompilerArgument ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  " S U P E R "    M O D I F I E R    C A L L    I N S T R U C T I O N     *
#                                                                           *
#---------------------------------------------------------------------------*

class @superModifierCallInstructionForGeneration extends @semanticInstructionForGeneration {
  @unifiedTypeMapProxy mReceiverType ;
  @string mSuperClassThatImplementsModifier ;
  @lstring mModifierName ;
  @actualParameterListForGeneration mActualParameterList ;
  @bool mHasCompilerArgument ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    M A T C H    I N S T R U C T I O N                                     *
#                                                                           *
#---------------------------------------------------------------------------*

list @matchListForGeneration {
  @bool mIsType ;
  @string mTypeNameOrEnumerationConstantName ;
  @string mLocalConstantName ; # Empy string if no variable
}

#---------------------------------------------------------------------------*

list @matchInstructionBranchListForGeneration {
  @matchListForGeneration mMatchListForGeneration ;
  @semanticInstructionListForGeneration mMatchBranchInstructionList ;
}

#---------------------------------------------------------------------------*

class @matchInstructionForGeneration extends @semanticInstructionForGeneration {
  @semanticExpressionListForGeneration mMatchedExpressionList ;
  @matchInstructionBranchListForGeneration mMatchInstructionBranchList ;
  @semanticInstructionListForGeneration mElseInstructionList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    C A S T    I N S T R U C T I O N                                       *
#                                                                           *
#---------------------------------------------------------------------------*

list @castInstructionBranchListForGeneration {
  @bool mUseKindOfClass ;
  @unifiedTypeMapProxy mType ;
  @string mCastedVarCppName ; # Empty string if no var
  @semanticInstructionListForGeneration mInstructionList ;
}

#---------------------------------------------------------------------------*

class @structuredCastInstructionForGeneration extends @semanticInstructionForGeneration {
  @semanticExpressionForGeneration mExpression ;
  @castInstructionBranchListForGeneration mCastBranchList ;
  @semanticInstructionListForGeneration mElseInstructionList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    A D D    A S S I G N    I N S T R U C T I O N      + =                 *
#                                                                           *
#---------------------------------------------------------------------------*

class @addAssignInstructionForGeneration extends @semanticInstructionForGeneration {
  @string mReceiverCppName ;
  @unifiedTypeMapProxy mTargetType ;
  @location mInstructionLocation ;
  @lstringlist mStructAttributeList ;
  @semanticExpressionListForGeneration mExpressionList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    I N C R E M E N T    I N S T R U C T I O N                             *
#                                                                           *
#---------------------------------------------------------------------------*

class @incrementInstructionForGeneration extends @semanticInstructionForGeneration {
  @location mInstructionLocation ;
  @string mReceiverCppName ;
  @unifiedTypeMapProxy mReceiverType ;
  @lstringlist mStructAttributeList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    D E C R E M E N T    I N S T R U C T I O N                             *
#                                                                           *
#---------------------------------------------------------------------------*

class @decrementInstructionForGeneration extends @semanticInstructionForGeneration {
  @location mInstructionLocation ;
  @string mReceiverCppName ;
  @unifiedTypeMapProxy mReceiverType ;
  @lstringlist mStructAttributeList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    L O O P    I N S T R U C T I O N                                       *
#                                                                           *
#---------------------------------------------------------------------------*

class @loopInstructionForGeneration extends @semanticInstructionForGeneration {
  @location mInstructionLocation ;
  @semanticExpressionForGeneration mVariantExpression ;
  @semanticInstructionListForGeneration mFirstInstructions ;
  @semanticExpressionForGeneration mLoopExpression ;
  @semanticInstructionListForGeneration mSecondInstructions ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  M E S S A G E    I N S T R U C T I O N                                   *
#                                                                           *
#---------------------------------------------------------------------------*

class @messageInstructionForGeneration extends @semanticInstructionForGeneration {
  @semanticExpressionForGeneration mExpression ;
  @location mInstructionLocation ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  L O G    I N S T R U C T I O N                                           *
#                                                                           *
#---------------------------------------------------------------------------*

class @logInstructionForGeneration extends @semanticInstructionForGeneration {
  @string mLogMessage ;
  @semanticExpressionForGeneration mLogExpression ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  G R A M M A R    I N S T R U C T I O N S                                 *
#                                                                           *
#---------------------------------------------------------------------------*

class @grammarInstructionWithSourceFileForGeneration extends @semanticInstructionForGeneration {
  @location mInstructionLocation ;
  @string mGrammarName ;
  @string mLabelName ;
  @semanticExpressionForGeneration mSourceFileExpression ;
  @actualParameterListForGeneration mActualParameterList ;
}

#---------------------------------------------------------------------------*

class @grammarInstructionWithSourceExpressionForGeneration extends @semanticInstructionForGeneration {
  @location mInstructionLocation ;
  @string mGrammarName ;
  @string mLabelName ;
  @semanticExpressionForGeneration mSourceStringExpression ;
  @actualParameterListForGeneration mActualParameterList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  R E A D  /  W R I T E    ' W I T H '    I N S T R U C T I O N            *
#                                                                           *
#---------------------------------------------------------------------------*

class @readWriteWithInstructionForGeneration extends @semanticInstructionForGeneration {
  @location mInstructionLocation ;
  @string mReceiverVariableCppName ;
  @unifiedTypeMapProxy mReceiverType ;
  @lstringlist mStructAttributeList ;
  @string mAccessName ;
  @string mObjectArrayCppName ;
  @semanticExpressionForGeneration mKeyExpression ;
  @semanticInstructionListForGeneration mDoBranchInstructions ;
  @semanticInstructionListForGeneration mElseBranchInstructions ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  R E A D  O N L Y    ' W I T H '    I N S T R U C T I O N                 *
#                                                                           *
#---------------------------------------------------------------------------*

class @readOnlyWithInstructionForGeneration extends @semanticInstructionForGeneration {
  @location mInstructionLocation ;
  @semanticExpressionForGeneration mReceiverExpression ;
  @string mAccessName ;
  @string mObjectArrayCppName ;
  @semanticExpressionForGeneration mKeyExpression ;
  @semanticInstructionListForGeneration mDoBranchInstructions ;
  @semanticInstructionListForGeneration mElseBranchInstructions ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  T E R M I N A L    C H E C K    I N S T R U C T I O N                    *
#                                                                           *
#---------------------------------------------------------------------------*

list @terminalCheckAssignementList {
  @string mTypeName ; # Empty string if no declaration
  @string mTargetVarCppName ;
  @string mSourceLexicalAttributeName ;
}

#---------------------------------------------------------------------------*

abstract class @syntaxInstructionForGeneration extends @semanticInstructionForGeneration {
  @location mInstructionLocation ;
}

#---------------------------------------------------------------------------*

class @terminalCheckInstructionForGeneration extends @syntaxInstructionForGeneration {
  @lstring mTerminalName ;
  @string mLexiqueIdentifier ;
  @terminalCheckAssignementList mTerminalCheckAssignementList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  N O N    T E R M I N A L    I N S T R U C T I O N                        *
#                                                                           *
#---------------------------------------------------------------------------*

class @nonterminalInstructionForGeneration extends @syntaxInstructionForGeneration {
  @string mNonterminalName ;
  @string mLabelName ;
  @actualParameterListForGeneration mActualParameterList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  R E P E A T    I N S T R U C T I O N                                     *
#                                                                           *
#---------------------------------------------------------------------------*

class @repeatInstructionForGeneration extends @syntaxInstructionForGeneration {
  @string mSyntaxComponentName ;
  @uint mChoiceIndex ;
  @semanticInstructionListForGeneration m_repeated_instructionList ;
  @location mEndOfRepeatedInstructions ;
  @listOfSemanticInstructionListForGeneration mListOfSemanticInstructionListForGeneration ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  S E L E C T    I N S T R U C T I O N                                     *
#                                                                           *
#---------------------------------------------------------------------------*

class @selectInstructionForGeneration extends @syntaxInstructionForGeneration {
  @string mSyntaxComponentName ;
  @uint mChoiceIndex ;
  @listOfSemanticInstructionListForGeneration mListOfSemanticInstructionListForGeneration ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  P A R S E    R E W I N D    I N S T R U C T I O N                        *
#                                                                           *
#---------------------------------------------------------------------------*

class @parseRewindInstructionForGeneration extends @syntaxInstructionForGeneration {
  @listOfSemanticInstructionListForGeneration mListOfSemanticInstructionListForGeneration ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  P A R S E    L O O P    I N S T R U C T I O N                            *
#                                                                           *
#---------------------------------------------------------------------------*

class @parseLoopInstructionForGeneration extends @syntaxInstructionForGeneration {
  @semanticExpressionForGeneration mVariantExpression ;
  @semanticExpressionForGeneration mWhileExpression ;
  @semanticInstructionListForGeneration mInstructionList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  P A R S E    W H E N    I N S T R U C T I O N                            *
#                                                                           *
#---------------------------------------------------------------------------*

class @parseWhenInstructionForGeneration extends @syntaxInstructionForGeneration {
  @semanticExpressionForGeneration mWhenExpression ;
  @semanticInstructionListForGeneration mInstructionList ;
  @semanticInstructionListForGeneration mElseInstructionList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#  S W I T C H    I N S T R U C T I O N                                     *
#                                                                           *
#---------------------------------------------------------------------------*

list @switchBranchesForGeneration {
  @lstringlist mSwitchConstantList ;
  @semanticInstructionListForGeneration mInstructions ;
}

#---------------------------------------------------------------------------*

class @switchInstructionForGeneration extends @semanticInstructionForGeneration {
  @semanticExpressionForGeneration mSwitchExpression ;
  @switchBranchesForGeneration mBranches ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    M A P    D E C L A R A T I O N                                         *
#                                                                           *
#---------------------------------------------------------------------------*

sortedlist @mapStateTransitionSortedList {
  @uint mActionIndex ;
  @string mActionName ;
  @uint mTargetStateIndex ;
  @string mTargetStateName ;
  @mapAutomatonMessageKind mTransitionMessageKind ;
  @string mTransitionMessage ;
}{
  mActionIndex <
}

#---------------------------------------------------------------------------*

sortedlist @mapStateSortedList {
  @uint mStateIndex ;
  @string mStateName ;
  @mapAutomatonMessageKind mStateMessageKind ;
  @string mStateMessage ;
  @mapStateTransitionSortedList mTransitionList ;
}{
  mStateIndex <
}

#---------------------------------------------------------------------------*

map @mapAutomatonStateMap {
  @uint mStateIndex ;
  insert insertKey error message "redefinition of '%K' map automaton state" ;
  search searchKey error message "undefined '%K' map automaton state" ;
}

#---------------------------------------------------------------------------*

map @mapAutomatonActionMap {
  @uint mActionIndex ;
  insert insertKey error message "redefinition of '%K' map automaton action" ;
  search searchKey error message "undefined '%K' map automaton action" ;
}

#---------------------------------------------------------------------------*

sortedlist @branchBehaviourSortedListForMapOverride {
  @uint mStartStateIndex ;
  @string mStartStateName ;
  @uint mCurrentStateIndex ;
  @string mCurrentStateName ;
  @uint mFinalStateIndex ;
  @string mFinalStateName ;
  @mapAutomatonMessageKind mBehaviourMessageKind ;
  @string mBehaviourMessage ;
}{
  mStartStateIndex <, mCurrentStateIndex <
}

#---------------------------------------------------------------------------*

list @mapOverrideList {
  @string mOverrideName ;
  @branchBehaviourSortedListForMapOverride mBranchBehaviourSortedListForMapOverride ;
  @branchBehaviourSortedListForMapOverride mBranchCombinationSortedListForMapOverride ;
}

#---------------------------------------------------------------------------*

class @mapTypeForGeneration extends @semanticTypeForGeneration {
  @lstring mMapTypeName ;
  @typedAttributeList mTypedAttributeList ;
  @insertMethodListAST mInsertMethodList ;
  @mapSearchMethodListAST mSearchMethodList ;
  @mapRemoveMethodListAST mRemoveMethodList ;
  @bool mHasInsertOrReplaceModifier ;
  @withAccessorMap mWithAccessorMap ; # Method for with accessor
}

#---------------------------------------------------------------------------*

class @uniqueMapTypeForGeneration extends @semanticTypeForGeneration {
  @lstring mMapTypeName ;
  @typedAttributeList mTypedAttributeList ;
  @insertMethodListAST mInsertMethodList ;
  @mapSearchMethodListAST mSearchMethodList ;
  @withAccessorMap mWithAccessorMap ; # Method for with accessor
  @mapAutomatonStateMap mMapAutomatonStateMap ;
  @mapAutomatonActionMap mMapAutomatonActionMap ;
  @mapStateSortedList mMapStateSortedList ;
  @mapOverrideList mMapOverrideList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    M A P    P R O X Y    D E C L A R A T I O N                            *
#                                                                           *
#---------------------------------------------------------------------------*

class @mapProxyTypeForGeneration extends @semanticTypeForGeneration {
  @unifiedTypeMapProxy mAssociatedMapTypeProxy ;
  @typedAttributeList mAssociatedMapTypedAttributeList ;
  @mapSearchMethodListAST mSearchMethodList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    C L A S S    D E C L A R A T I O N                                     *
#                                                                           *
#---------------------------------------------------------------------------*

list @abstractMethodDefinitionListForGeneration {
  @bool mIsOverriding ;
  @lstring mMethodName ;
  @formalParameterListForGeneration mSignature ;
}

#---------------------------------------------------------------------------*

list @methodDefinitionListForGeneration {
  @bool mIsOverriding ;
  @lstring mMethodName ;
  @formalParameterListForGeneration mSignature ;
  @semanticInstructionListForGeneration mInstructionList ;
}

#---------------------------------------------------------------------------*

#list @classMessageDefinitionListForGeneration {
#  @lstring mMessageName ;
#  @lstring mMessageValue ;
#}

#---------------------------------------------------------------------------*

#list @lazyAttributeListForGeneration {
#  @location mLocationMagicNumber ;
#  @attributeInCollectionListForGeneration mAttributeList ;
#  @semanticInstructionListForGeneration mInstructionList ;
#}

#---------------------------------------------------------------------------*

class @classTypeForGeneration extends @semanticTypeForGeneration {
  @bool mIsAbstract ;
  @lstring mClassTypeName ;
  @unifiedTypeMapProxy mSuperClass ; # Null if no super class
#  @lstringlist mClassFeatureList ;
  @typedAttributeList mAllTypedAttributeList ; # Inherited followed by current attributes
  @typedAttributeList mTypedAttributeList ;
  @abstractMethodDefinitionListForGeneration mAbstractMethodList ;
  @methodDefinitionListForGeneration mMethodList ;
#  @lazyAttributeListForGeneration mLazyAttributeList ;
  @instanceMethodMap mInstanceMethodMap ;
  @bool mGenerateHeaderInSeparateFile ; # Significant only for classes
}

#---------------------------------------------------------------------------*
#                                                                           *
#    L I S T M A P    D E C L A R A T I O N                                 *
#                                                                           *
#---------------------------------------------------------------------------*

class @listmapTypeForGeneration extends @semanticTypeForGeneration {
  @unifiedTypeMapProxy mAssociatedListTypeIndex ;
  @typedAttributeList mAssociatedListTypedAttributeList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    P R I M I T I V E    T Y P E                                           *
#                                                                           *
#---------------------------------------------------------------------------*

class @primitiveTypeForGeneration extends @semanticTypeForGeneration {
  @string mPredefinedTypeName ;
  @predefinedTypeKindEnum mKind ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    L I S T    T Y P E    D E C L A R A T I O N                            *
#                                                                           *
#---------------------------------------------------------------------------*

class @listTypeForGeneration extends @semanticTypeForGeneration {
  @typedAttributeList mTypedAttributeList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    S T R U C T    D E C L A R A T I O N                                   *
#                                                                           *
#---------------------------------------------------------------------------*

class @structTypeForGeneration extends @semanticTypeForGeneration {
  @typedAttributeList mTypedAttributeList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    S O R T E D    L I S T    D E C L A R A T I O N                        *
#                                                                           *
#---------------------------------------------------------------------------*

list @sortDescriptorListForGeneration {
  @unifiedTypeMapProxy mAttributeTypeIndex ;
  @string mAttributeName ;
  @bool mAscendingOrder ;
}

#---------------------------------------------------------------------------*

class @sortedListTypeForGeneration extends @semanticTypeForGeneration {
  @typedAttributeList mTypedAttributeList ;
  @sortDescriptorListForGeneration mSortDescriptorList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    E N U M    D E C L A R A T I O N                                       *
#                                                                           *
#---------------------------------------------------------------------------*

sortedlist @enumMessageAssociationSortedListForGeneration {
  @uint mConstantIndex ;
  @string mConstantName ;
  @string mMessage ;
}{
  mConstantIndex <
}

#---------------------------------------------------------------------------*

list @enumMessageListForGeneration {
  @string mEnumMessageName ;
  @enumMessageAssociationSortedListForGeneration mMessageAssociationList ;
}

#---------------------------------------------------------------------------*

class @enumTypeForGeneration extends @semanticTypeForGeneration {
  @stringlist mConstantList ;
  @enumMessageListForGeneration mEnumMessageList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
# A B S T R A C T   C A T E G O R Y    M E T H O D    D E C L A R A T I O N *
#                                                                           *
#---------------------------------------------------------------------------*

class @abstractCategoryMethodForGeneration extends @semanticDeclarationForGeneration {
  @string mTypeName ;
  @string mAbstractCategoryMethodName ;
  @formalParameterListForGeneration mAbstractCategoryMethodFormalParameterList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
# C A T E G O R Y    M E T H O D    D E C L A R A T I O N                   *
#                                                                           *
#---------------------------------------------------------------------------*

class @categoryMethodForGeneration extends @semanticDeclarationForGeneration {
  @string mTypeName ;
  @string mCategoryMethodName ;
  @formalParameterListForGeneration mCategoryMethodFormalParameterList ;
  @typedAttributeList mTypedAttributeList ;
  @semanticInstructionListForGeneration mSemanticInstructionListForGeneration ;
}

#---------------------------------------------------------------------------*
#                                                                           *
# O V E R R I D I N G    C A T E G O R Y    M E T H O D    D E C .          *
#                                                                           *
#---------------------------------------------------------------------------*

class @overridingCategoryMethodForGeneration extends @semanticDeclarationForGeneration {
  @string mTypeName ;
  @string mBaseTypeName ;
  @string mCategoryMethodName ;
  @formalParameterListForGeneration mCategoryMethodFormalParameterList ;
  @typedAttributeList mTypedAttributeList ;
  @semanticInstructionListForGeneration mSemanticInstructionListForGeneration ;
}

#---------------------------------------------------------------------------*
#                                                                           *
# A B S T R A C T   C A T E G O R Y    R E A D E R    D E C L A R A T I O N *
#                                                                           *
#---------------------------------------------------------------------------*

class @abstractCategoryReaderForGeneration extends @semanticDeclarationForGeneration {
  @string mTypeName ;
  @string mAbstractCategoryReaderName ;
  @unifiedTypeMapProxy mResultType ;
  @formalInputParameterListForGeneration mAbstractCategoryReaderFormalParameterList ;
}

#---------------------------------------------------------------------------*
#                                                                           *
# C A T E G O R Y    R E A D E R    D E C L A R A T I O N                   *
#                                                                           *
#---------------------------------------------------------------------------*

class @categoryReaderForGeneration extends @semanticDeclarationForGeneration {
  @string mTypeName ;
  @string mCategoryReaderName ;
  @unifiedTypeMapProxy mResultType ;
  @string mResultVarCppName ;
  @formalInputParameterListForGeneration mCategoryReaderFormalParameterList ;
  @typedAttributeList mTypedAttributeList ;
  @semanticInstructionListForGeneration mSemanticInstructionListForGeneration ;
}

#---------------------------------------------------------------------------*
#                                                                           *
# O V E R R I D E    C A T E G O R Y    R E A D E R    D E C L A R A T I O N*
#                                                                           *
#---------------------------------------------------------------------------*

class @overrideCategoryReaderForGeneration extends @semanticDeclarationForGeneration {
  @string mTypeName ;
  @string mBaseTypeName ;
  @string mOverridingCategoryReaderName ;
  @unifiedTypeMapProxy mResultType ;
  @string mResultVarCppName ;
  @formalInputParameterListForGeneration mOverridingCategoryReaderFormalParameterList ;
  @typedAttributeList mTypedAttributeList ;
  @semanticInstructionListForGeneration mSemanticInstructionListForGeneration ;
}

#---------------------------------------------------------------------------*
#                                                                           *
#    F I L E W R A P P E R    D E C L A R A T I O N                         *
#                                                                           *
#---------------------------------------------------------------------------*

list @filewrapperTemplateListForGeneration {
  @string mFilewrapperTemplateName ;
  @formalInputParameterListForGeneration mFilewrapperTemplateFormalInputParameters ;
  @templateInstructionListForGeneration mTemplateInstructionListForGeneration ;
}

#---------------------------------------------------------------------------*

class @filewrapperDeclarationForGeneration extends @semanticDeclarationForGeneration {
  @string mFilewrapperName ;
  @string mFilewrapperAbsolutePath ;
  @wrapperFileMap mFilewrapperFileMap ;
  @wrapperDirectoryMap mFilewrapperDirectoryMap ;
  @filewrapperTemplateListForGeneration mFilewrapperTemplateListForGeneration ;
}

#---------------------------------------------------------------------------*

end semantics ;
