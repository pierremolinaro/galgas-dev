%!TEX encoding = UTF-8 Unicode
%!TEX root = ../galgas-book.tex

%-----------------------------------------------------------------------------------------------------------------------*
%                                                                                                                       *
%   P A R T I C U L A R I S A T I O N   D U    P A Q U E T A G E    « L I S T I N G S »                                 *
%                                                                                                                       *
%-----------------------------------------------------------------------------------------------------------------------*

\lstdefinelanguage{galgas}{
%  keywordsprefix=\@,
  morekeywords=[2]{abstract, after, array, before, between, block, cast, class, const, constructor, default, do, drop, else, elsif, end, enum,
    error, extends, extern, false, feature, filewrapper, foreach, function, grammar, graph, gui, here, if,
    import, in, index, indexing, insert, is, label, lexique, list, listmap, local, log, loop, map, mapproxy, match,
    message, method, mod, modifier, nonterminal, not, on, once, operator, option, or, override, parse, pragma,
    prefixedby, project, program, reader, remove, replace, repeat, rewind, root, routine, rule, search, select,
    self, selfcopy, semantics, send, sortedlist, state, struct, style, switch, syntax, tag, template,
    then, to, true, uniquemap, unused, warning, when, while, with
  },
  comment=[l]\#,
  string=[b]", string=[d]",
  style=galgas
}

\newcommand\couleurCodeGALGAS{green!25}


\ifthenelse{\equal{\sortieEnCouleur}{true}}{
  \lstdefinestyle{galgas}{
    basicstyle=\ttfamily\smaller,
%    keywordstyle=\color{red}\textbf,
%    frame=l,
    upquote=true,
    xleftmargin=16pt,
    keywordstyle=[2]\color{blue},
    backgroundcolor=\color{\couleurCodeGALGAS},
    identifierstyle=\color{brown},
    commentstyle=\color{red},
    stringstyle=\color{gray}
  }
}{
  \lstdefinestyle{galgas}{
    basicstyle=\ttfamily,
    upquote=true,
    keywordstyle=\sffamily\textbf
  }
}

%-----------------------------------------------------------------------------------------------------------------------*

\newcommand\galgas[1]{\colorbox{\couleurCodeGALGAS}{\lstinline[language=galgas]\%#1\%}}

\lstnewenvironment{galgascode}{\lstset{language=galgas}}{}

%-----------------------------------------------------------------------------------------------------------------------*
%                                                                                                                       *
% A F F I C H A G E    E T    C R O S S   R É F É R E N C E    D E S    T Y P E S    P R É D É F I N I S   G A L G A S  *
%                                                                                                                       *
%-----------------------------------------------------------------------------------------------------------------------*

%--- Les deux macros suivantes définissent une section et une sous-section :
%      - en formattant le titre
%      - en définissant un label pour cross référence ;
%      - en définissant une entrée dans l'index

% Exemple d'appel : \sectionTypePredefiniLabelIndex{bool}

\newcommand \chapitreTypePredefiniLabelIndex[1] {\chapter{Le type \texttt{@#1}}\label{type:#1}\index{Type!"@#1}}

\newcommand \sectionTypePredefiniLabelIndex[1] {\section{Le type \texttt{@#1}}\label{type:#1}\index{Type!"@#1}}

\newcommand \subsectionTypePredefiniLabelIndex[1] {\subsection{Le type \texttt{@#1}}\label{type:#1}\index{Type!"@#1}}




%--- Cette macro établit un hyperlien vers un type prédéfini
% Exemple d'appel : \refTypePredefini{bool} -- affiche --> @bool type (page xx)

\newcommand \refTypePredefini[1] {\hyperref[type:#1]{type \texttt{@#1} (page \pageref{type:#1})}}

%-----------------------------------------------------------------------------------------------------------------------*
%                                                                                                                       *
%                         D É F I N I T I O N   D ' U N   R E A D E R   S A N S   A R G U M E N T                       *
%                                                                                                                       *
%-----------------------------------------------------------------------------------------------------------------------*

%--- Définition d'un reader sans argument
% Exemple d'appel :
% \readerSansArgument{line} % Nom du reader
% {@location} % Nom du type
% {1.8.2} % Première version GALGAS qui implémente ce reader
% {@uint} % Type renvoyé
% {Returns the line of the receiver's value.} % Description
% {this reader raises a run-time error if ...} % Discussion

%http://compgroups.net/comp.text.tex/Robust-definition-of-a-new-command

\newcommand\labelReaderSansArgument[2]{}

\newcommand\readerSansArgument[6] {
  \subsection{\texttt{#1} Reader}\label{reader:#2:#1}\index{#1!"@#2 reader}
  #5
  \newline
  \newline
  \colorbox{\couleurCodeGALGAS}{
    \begin{tabular}{l}
    \texttt{\textbf{reader} @#2 #1 -> @#4 ;}
    \end{tabular}
  }
  \newline
  \newline
  \textbf{Availability:} available in GALGAS #3 and later.
  \ifthenelse{\equal{#6}{}}{
  }{
    \newline
    \newline
    \textbf{Discussion:} #6
  }
  \newline
}

%-----------------------------------------------------------------------------------------------------------------------*
%                                                                                                                       *
%                                     R É F É R E N C E   À   U N   R E A D E R                                         *
%                                                                                                                       *
%-----------------------------------------------------------------------------------------------------------------------*

% Exemple d'appel : \refReaderPage{bool}{string} -- affiche --> @bool string reader (page xx)
\newcommand \refReaderPage[2] {\hyperref[reader:#1:#2]{@#1 #2 reader (page \pageref{reader:#1:#2})}}

%---------------------------------------------------------------------*

%--- Définition d'un reader à 1 argument
% Exemple d'appel :
% \readerUnArgument{line} % Nom du reader
% {location} % Nom du type
% {1.8.2} % Première version GALGAS qui implémente ce reader
% {uint} % Type renvoyé
% {Returns the line of the receiver's value.} % Description
% {this reader raises a run-time error if ...} % Discussion

\newcommand \readerUnArgument[7] {
  \subsection{\texttt{#1} Reader}\label{reader:#2:#1}\index{#1!"@#2 reader}
  #6
  \newline
  \newline
  \colorbox{\couleurCodeGALGAS}{
    \begin{tabular}{l}
      \texttt{\textbf{reader} @#2 #1}\\
      \texttt{\ \ ?#5}\\
      \texttt{\ \ -> @#4 ;}
    \end{tabular}
  }
  \newline
  \newline
  \textbf{Availability:} available in GALGAS #3 and later.
  \ifthenelse{\equal{#7}{}}{
  }{
    \newline
    \newline
    \textbf{Discussion:} #7
  }
  \newline
}

%---------------------------------------------------------------------*

%--- Définition d'un reader à 2 arguments
% Exemple d'appel :
% \readerSansArgument{line} % Nom du reader
% {location} % Nom du type
% {1.8.2} % Première version GALGAS qui implémente ce reader
% {uint} % Type renvoyé
% {Returns the line of the receiver's value.} % Description
% {this reader raises a run-time error if ...} % Discussion

\newcommand \readerDeuxArguments[8] {
  \subsection{\texttt{#1} Reader}\label{reader:#2:#1}\index{#1!"@#2 reader}
  #7
  \newline
  \newline
  \colorbox{\couleurCodeGALGAS}{
    \begin{tabular}{l}
    \texttt{\textbf{reader} @#2 #1}\\
    \texttt{\ \ ?#5}\\
    \texttt{\ \ ?#6}\\
    \texttt{\ \ -> @#4 ;}
    \end{tabular}
  }
  \newline
  \newline
  \textbf{Availability:} available in GALGAS #3 and later.
  \ifthenelse{\equal{#8}{}}{
  }{
    \newline
    \newline
    \textbf{Discussion:} #8
  }
  \newline
}

%---------------------------------------------------------------------*

%--- Définition d'un reader à 3 arguments

\newcommand \readerTroisArguments[9] {
  \subsection{\texttt{#1} Reader}\label{reader:#2:#1}\index{#1!"@#2 reader}
  #8
  \newline
  \newline
  \colorbox{\couleurCodeGALGAS}{
    \begin{tabular}{l}
    \texttt{\emph{reader} @#2 #1}\\
    \texttt{\ \ ?#5}\\
    \texttt{\ \ ?#6}\\
    \texttt{\ \ ?#7}\\
    \texttt{\ \ -> @#4 ;}
    \end{tabular}
  }
  \newline
  \newline
  \textbf{Availability:} available in GALGAS #3 and later.
  \ifthenelse{\equal{#9}{}}{
  }{
    \newline
    \newline
    \textbf{Discussion:} #9
  }
  \newline
}

%---------------------------------------------------------------------*

\newcommand \lienConstructeur[2] {\hyperref[constructor:#1:#2]{#2 constructor (page \pageref{constructor:#1:#2})}}

%---------------------------------------------------------------------*

%--- Définition d'un constructeur sans argument
% Exemple d'appel :
% \constructeurSansArgument{nowhere} % Nom du constructeur
% {location} % Nom du type
% {1.8.2} % Première version GALGAS qui implémente ce constructeur
% {uint} % Type renvoyé
%{Returns an \nomType{location} that does not points out any location.} % Description
%{The returned object responds \motCle{true} to the isNowhere reader.} % Discussion

\newcommand \constructeurSansArgument[6] {
  \subsection{\texttt{#1} Constructor}\label{constructor:#2:#1}\index{#1!"@#2 constructor}
  #5
  \newline
  \newline
  \colorbox{\couleurCodeGALGAS}{
    \begin{tabular}{l}
    \texttt{\textbf{constructor} @#2 #1 -> @#4 ;}
    \end{tabular}
  }
  \newline
  \newline
  \textbf{Availability:} available in GALGAS #3 and later.
  \ifthenelse{\equal{#6}{}}{
  }{
    \newline
    \newline
    \textbf{Discussion:} #6
  }
  \newline
}

%---------------------------------------------------------------------*

%--- Définition d'un constructeur avec 1 argument

\newcommand \constructeurUnArgument[7] {
  \subsection{\texttt{#1} Constructor}\label{constructor:#2:#1}\index{#1!"#2 constructor}
  #6
  \newline
  \newline
  \colorbox{\couleurCodeGALGAS}{
    \begin{tabular}{l}
    \texttt{\textbf{constructor} @#2 #1}\\
    \texttt{\ \ ?#5}\\
    \texttt{\ \ -> @#4 ;}
    \end{tabular}
  }
  \newline
  \newline
  \textbf{Availability:} available in GALGAS #3 and later.
  \ifthenelse{\equal{#7}{}}{
  }{
    \newline
    \newline
    \textbf{Discussion:} #7
  }
  \newline
}

%---------------------------------------------------------------------*

%--- Définition d'un constructeur avec 2 arguments

\newcommand \constructeurDeuxArguments[8] {
  \subsection{\texttt{#1} Constructor}\label{constructor:#2:#1}\index{#1!"@#2 constructor}
  #7
  \newline
  \newline
  \colorbox{\couleurCodeGALGAS}{
    \begin{tabular}{l}
    \texttt{\textbf{constructor} @#2 #1}\\
    \texttt{\ \ ?#5}\\
    \texttt{\ \ ?#6}\\
    \texttt{\ \ -> @#4 ;}
    \end{tabular}
  }
  \newline
  \newline
  \textbf{Availability:} available in GALGAS #3 and later.
  \ifthenelse{\equal{#8}{}}{
  }{
    \newline
    \newline
    \textbf{Discussion:} #8
  }
  \newline
}

%---------------------------------------------------------------------*

%--- Définition d'un constructeur avec 3 arguments

\newcommand \constructeurTroisArguments[9] {
  \subsection{\texttt{#1} Constructor}\label{constructor:#2:#1}\index{#1!"@#2 constructor}
  #8
  \newline
  \newline
  \colorbox{\couleurCodeGALGAS}{
    \begin{tabular}{l}
    \texttt{\textbf{constructor} @#2 #1}\\
    \texttt{\ \ ?#5}\\
    \texttt{\ \ ?#6}\\
    \texttt{\ \ ?#7}\\
    \texttt{\ \ -> @#4 ;}
    \end{tabular}
  }
  \newline
  \newline
  \textbf{Availability:} available in GALGAS #3 and later.
  \ifthenelse{\equal{#9}{}}{
  }{
    \newline
    \newline
    \textbf{Discussion:} #9
  }
  \newline
}

%---------------------------------------------------------------------*

%--- Définition d'un modifier à 1 argument

\newcommand \modifierUnArgument[6] {
  \subsection{\texttt{#1} Modifier}\label{modifier:#2:#1}\index{#1!"@#2 modifier}
  #5
  \newline
  \newline
  \colorbox{\couleurCodeGALGAS}{
    \begin{tabular}{l}
    \texttt{\textbf{modifier} @#2 #1}\\
    \texttt{\ \ ?#4}\\
    \end{tabular}
  }
  \newline
  \newline
  \textbf{Availability:} available in GALGAS #3 and later.
  \ifthenelse{\equal{#6}{}}{
  }{
    \newline
    \newline
    \textbf{Discussion:} #6
  }
  \newline
}

%---------------------------------------------------------------------*
