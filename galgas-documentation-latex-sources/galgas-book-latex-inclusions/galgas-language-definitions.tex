%!TEX encoding = UTF-8 Unicode
%!TEX root = ../galgas-book.tex

%-----------------------------------------------------------------------------------------------------------------------*
%   A F F I C H A G E    D U    C O D E    G A L G A S                                                                  *
%-----------------------------------------------------------------------------------------------------------------------*

\newcommand\tpp[1]{\colorbox{gray!12}{\ttfamily #1}}

%-----------------------------------------------------------------------------------------------------------------------*
%   A F F I C H A G E    D U    C O D E    G A L G A S                                                                  *
%-----------------------------------------------------------------------------------------------------------------------*

\newcommand\keywordsStyleGalgas[1]{\textcolor{blue}{\textbf{#1}}}
\newcommand\delimitersStyleGalgas[1]{\textcolor{brown}{\textbf{#1}}}
\newcommand\selectorStyleGalgas[1]{\textcolor{orange}{#1}}
\newcommand\terminalStyleGalgas[1]{\textcolor{orange}{#1}}
\newcommand\nonTerminalStyleGalgas[1]{\textcolor{orange}{#1}}
\newcommand\integerStyleGalgas[1]{\textcolor{brown}{#1}}
\newcommand\floatStyleGalgas[1]{\textcolor{magenta}{#1}}
\newcommand\characterStyleGalgas[1]{\textcolor{cyan}{#1}}
\newcommand\stringStyleGalgas[1]{\textcolor{gray}{#1}}
\newcommand\typeNameStyleGalgas[1]{\textcolor{gray}{#1}}
\newcommand\attributeStyleGalgas[1]{\textcolor{brown}{#1}}
\newcommand\commentStyleGalgas[1]{\textcolor{red}{#1}}

%\newcommand\lexicalErrorGalgas{\textcolor{red}{\textbullet ERRLEX\textbullet}}

\newcommand\keywordsStylegalgas[1]{\textcolor{blue}{\textbf{#1}}}
\newcommand\delimitersStylegalgas[1]{\textcolor{brown}{\textbf{#1}}}
\newcommand\selectorStylegalgas[1]{\textcolor{orange}{#1}}
\newcommand\terminalStylegalgas[1]{\textcolor{orange}{#1}}
\newcommand\nonTerminalStylegalgas[1]{\textcolor{orange}{#1}}
\newcommand\integerStylegalgas[1]{\textcolor{brown}{#1}}
\newcommand\floatStylegalgas[1]{\textcolor{magenta}{#1}}
\newcommand\characterStylegalgas[1]{\textcolor{cyan}{#1}}
\newcommand\stringStylegalgas[1]{\textcolor{gray}{#1}}
\newcommand\typeNameStylegalgas[1]{\textcolor{gray}{#1}}
\newcommand\attributeStylegalgas[1]{\textcolor{brown}{#1}}
\newcommand\commentStylegalgas[1]{\textcolor{red}{#1}}

%\newcommand\lexicalErrorgalgas{\textcolor{red}{\textbullet ERRLEX\textbullet}}

\newmdenv[
  topline=false,
  bottomline=false,
  rightline=false,
%  skipabove=\topsep,
%  skipbelow=\topsep,
  linecolor=blue!25,
  linewidth=2pt
]{siderules}

\newwrite\tempfile

\makeatletter
\newenvironment{galgas}{%
  \begingroup
  \@bsphack
  \immediate\openout\tempfile=temp.galgas%
  \let\do\@makeother\dospecials
  \catcode`\^^M\active
  \verbatim@startline
  \verbatim@addtoline
  \verbatim@finish
  \def\verbatim@processline{\immediate\write\tempfile{\the\verbatim@line}}%
  \verbatim@start
}{
  \immediate\closeout\tempfile
  \@esphack
  \endgroup
  \immediate\write18{galgas --mode=latex:Galgas temp.galgas}
  {\singlespacing\begin{siderules}\ttfamily\input{temp.galgas.tex}\end{siderules}}
}
\makeatother

%-----------------------------------------------------------------------------------------------------------------------*
% COMMANDE \ggs : affichage de code en ligne galgas                                                                     *
%-----------------------------------------------------------------------------------------------------------------------*

\makeatletter
\newcommand*\ggs{%
  \@bsphack%
  \begingroup%
  \let\do\@makeother\dospecials%
  \let\do\do@noligs\verbatim@nolig@list%
  \catcode`\^^M=15\relax%
  \@vobeyspaces%
  \@ggs{\temporary}%
}%
\newcommand\@ggs[2]{%
  \catcode`-=12\relax%
  \catcode`<=12\relax%
  \catcode`>=12\relax%
  \catcode`,=12\relax%
  \catcode`'=12\relax%
  \catcode``=12\relax%
  \catcode`#2\active%
  \catcode`~\active%
  \lccode`\~`#2\relax%
  \begingroup%
  \lowercase{%
    \def\@tempa##1~{%
      \expandafter\endgroup%
      \expandafter\DeclareRobustCommand%
      \expandafter*%
      \expandafter#1%
      \expandafter{\@tempa}%
      \@esphack%
      \immediate\openout\tempfile=temp.galgas%
      \immediate\write\tempfile{##1}%
      \immediate\closeout\tempfile%
      \immediate\write18{galgas --mode=latex:Galgas temp.galgas}%
      \colorbox{gray!6}{\ttfamily\input{temp.galgas.tex}\unskip}%
    }%
  }%
  \ifnum`#2=`\~\else\@makeother\~\fi%
  \expandafter\endgroup%
  \@tempa%
}%
\makeatother

%-----------------------------------------------------------------------------------------------------------------------*
%                                                                                                                       *
% A F F I C H A G E    E T    C R O S S   R É F É R E N C E    D E S    T Y P E S    P R É D É F I N I S   G A L G A S  *
%                                                                                                                       *
%-----------------------------------------------------------------------------------------------------------------------*

%--- Les deux macros suivantes définissent une section et une sous-section :
%      - en formattant le titre
%      - en définissant un label pour cross référence ;
%      - en définissant une entrée dans l'index

% Exemple d'appel : \sectionTypePredefiniLabelIndex{bool}

\newcommand \chapitreTypePredefiniLabelIndex[1] {\chapter{Le type \texttt{@#1}}\label{type:#1}\index{Type!"@#1}}

\newcommand \sectionTypePredefiniLabelIndex[1] {\section{Le type \texttt{@#1}}\label{type:#1}\index{Type!"@#1}}

\newcommand \subsectionTypePredefiniLabelIndex[1] {\subsection{Le type \texttt{@#1}}\label{type:#1}\index{Type!"@#1}}

%--- Cette macro établit un hyperlien vers un type prédéfini
% Exemple d'appel : \refTypePredefini{bool} -- affiche --> @bool type (page xx)

\newcommand \refTypePredefini[1] {\hyperref[type:#1]{\texttt{@#1} (page \pageref{type:#1})}}

%-----------------------------------------------------------------------------------------------------------------------*
%   G E T T E R   C R O S S    R E F E R E N C I N G                                                                    *
%-----------------------------------------------------------------------------------------------------------------------*

\newcommand\subsectionGetter[2]{\subsection{Getter \texttt{#1}}\label{getter:#2:#1}\index{#1!"@#2 getter}}

%-----------------------------------------------------------------------------------------------------------------------*

% Exemple d'appel : \refGetterPage{bool}{string} -- affiche --> @bool string getter (page xx)
\newcommand\refGetterPage[2] {\hyperref[getter:#1:#2]{getter \texttt{@#1 #2} à la page \pageref{getter:#1:#2}}}

%-----------------------------------------------------------------------------------------------------------------------*
%   S E T T E R   C R O S S    R E F E R E N C I N G                                                                    *
%-----------------------------------------------------------------------------------------------------------------------*

\newcommand\subsectionSetter[2]{\subsection{Setter \texttt{#1}}\label{setter:#2:#1}\index{#1!"@#2 getter}}

%-----------------------------------------------------------------------------------------------------------------------*

% Exemple d'appel : \refSetterPage{bool}{string} -- affiche --> @bool string setter (page xx)
\newcommand\refSetterPage[2] {\hyperref[setter:#1:#2]{setter \texttt{@#1 #2} à la page \pageref{setter:#1:#2}}}


%-----------------------------------------------------------------------------------------------------------------------*
%   C O N S T R U C T O R   C R O S S    R E F E R E N C I N G                                                          *
%-----------------------------------------------------------------------------------------------------------------------*

\newcommand\subsectionConstructor[2]{\subsection{Constructeur \texttt{#1}}\label{constructor:#2:#1}\index{#1!"@#2 constructor}}

%-----------------------------------------------------------------------------------------------------------------------*

\newcommand \refConstructorPage[2] {\hyperref[constructor:#1:#2]{#2 constructor (page \pageref{constructor:#1:#2})}}

%-----------------------------------------------------------------------------------------------------------------------*
