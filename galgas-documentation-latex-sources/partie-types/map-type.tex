%!TEX encoding = UTF-8 Unicode
%!TEX root = ../galgas-book.tex

%--------------------------------------------------------------
\chapterLabel{Le type \texttt{map}}{typeMap}
%-------------------------------------------------------------

\tableDesMatieresLocaleDeProfondeurRelative{1}


Un objet de type \ggs+map+ est une table de symboles, chaque symbole étant associé à des valeurs. Un objet de type \ggs+map+ a une sémantique de valeur.

\section{Déclaration}

La déclaration d'un type \ggs+map+ nomme~:
\begin{itemize}
  \item des propriétés associées au type table~;
  \item les \emph{setters} d'insertion (\refSectionPage{setterInsertionTable})~;
  \item les \emph{méthodes} de recherche (\refSectionPage{methodesRechercheTable})~;
  \item les \emph{setters} de retrait (\refSectionPage{setterRetraitTable})~;
  \item zéro ou un \emph{setter} d'insertion ou de remplacement (\refSectionPage{setterInsertOrReplace}).
\end{itemize}

Les clés sont déclarées implicitement et sont du type \refTypePredefini{lstring}.

Par exemple~:

\begin{galgas}
map @MaTable {
  public let @string mPremier
  public var @bool mSecond
  %insertSetter insertKey %errorMessage "the '%K' key is already declared in %L"
  %searchMethod searchKey %errorMessage "the '%K' key is not defined"
  %removeSetter removeKey %errorMessage "the '%K' key is not defined"
  %insertOrReplaceSetter
}
\end{galgas}







\section{Constructeurs}

\subsection{Construire une table vide}

Pour construire une table vide, on appelle  la constante \texttt{\{\}}~:
\begin{galgas}
var @MaTable uneTable = {}
\end{galgas}

Ou encore~:

\begin{galgas}
var uneTable = @MaTable {}
\end{galgas}

%\subsectionLabel{Constructeur \texttt{emptyMap}}{constructeurEmptyMap}
%
%Pour instancier une table vide, une autre possibilité est d'appeler le constructeur \ggs=emptyMap=. Exemple~:
%\begin{galgas}
%@MaTable uneTable = .emptyMap
%\end{galgas}
%
%Ou encore~:
%
%\begin{galgas}
%var uneTable = @MaTable.emptyMap
%\end{galgas}

 

%\subsectionLabel{Constructeur \texttt{default}}{constructeurMapDefault}
%
%
%Une table accepte le constructeur \ggs=default=. Exemple~:
%\begin{galgas}
%@MaTable uneTable = .default
%\end{galgas}
%
%Ou encore~:
%
%\begin{galgas}
%var uneTable = @MaTable.default
%\end{galgas}

 

\subsection{Constructeur \texttt{mapWithMapToOverride}}

\begin{galgas}
constructor mapWithMapToOverride ?@T inMapToOverride -> @T
\end{galgas}

Ce constructeur permet d'instancier une table vide, qui surcharge la table \ggs+inMapToOverride+ citée en argument. Exemple~:
\begin{galgas}
var @MaTable uneTable = {}
var @MaTable autreTableTable = .mapWithMapToOverride {!uneTable}
\end{galgas}






\sectionLabel{Setters d'insertion}{setterInsertionTable}

Une \ggs+map+ peut déclarer zéro, un ou plusieurs \emph{setters} d'insertion. Un \emph{setter} d'insertion permet d'insérer une nouvelle entrée à une table. Une erreur est déclenchée en cas de tentative d'une clé déjà existante.


Un \emph{setter} d'insertion est déclaré par~:

\begin{galgas}
%insertSetter nom %errorMessage "message_erreur"
\end{galgas}

L'identificateur \ggs+nom+ donne un nom au \emph{setter} d'insertion~; ce nom doit être unique parmi les \emph{setters} d'insertion et de retrait. La chaîne de caractères \ggs+"message_erreur"+ définit le message d'erreur qui est affiché en cas de tentative d'une clé déjà existante. Cette chaîne accepte deux séquences d'échappement~:
\begin{itemize}
  \item \texttt{\%K}, qui est remplacée par la chaîne de caractères de la clé existante~;
  \item \texttt{\%L}, qui est remplacée par la chaîne décrivant la position de la clé existante dans les fichiers source.
\end{itemize}


Un \emph{setter} d'insertion est appelé dans une \emph{instruction d'appel de setter}, comprenant tous ses arguments en sortie~:
\begin{itemize}
  \item le premier argument est une expression de type \ggs+@lstring+ qui caractérise la clé à insérer~;
  \item ensuite, pour chaque propriété déclarée, une expression du type de cette propriété.
\end{itemize}

Par exemple~:
\begin{galgas}
var @MaTable uneTable = {}
var @lstring clef = ...
var @string s = ...
var @uint v = ...
[!?uneTable insertKey !clef !s !v]
\end{galgas}









\sectionLabel{Setter d'insertion ou de remplacement}{setterInsertOrReplace}

Une \ggs+map+ peut déclarer un \emph{setter} effectuant selon le contexte une insertion ou un remplacement~:
\begin{itemize}
  \item si la clé n'existe pas, une insertion est réalisée~;
  \item si elle existe , le remplacement est effectué.
\end{itemize}

Un \emph{setter} d'insertion ou de remplacement est déclaré par~:

\begin{galgas}
%insertOrReplaceSetter
\end{galgas}

Son nom est toujours \ggs!insertOrReplace!. Il est appelé dans une \emph{instruction d'appel de setter}, comprenant tous ses arguments en sortie~:
\begin{itemize}
  \item le premier argument est une expression de type \ggs+@lstring+ qui caractérise la clé à insérer~;
  \item ensuite, pour chaque propriété déclarée, une expression du type de cette propriété.
\end{itemize}

Par exemple~:
\begin{galgas}
var @MaTable uneTable = {}
var @lstring clef = ...
var @string s = ...
var @uint v = ...
[!?uneTable insertOrReplace !clef !s !v] # Insertion
[!?uneTable insertOrReplace !clef !s !v] # Remplacement
\end{galgas}










\sectionLabel{Méthodes de recherche}{methodesRechercheTable}

Une \ggs+map+ peut déclarer zéro, une ou plusieurs \emph{méthodes} de recherche. Une \emph{méthode} de recherche permet de rechercher une entrée d'une table, et retourne la valeur de ses propriétés associées. Une erreur est déclenchée si la clé n'existe pas.


Une \emph{méthode} de recherche est déclarée par~:


\begin{galgas}
%searchMethod nom %errorMessage "message_erreur"
\end{galgas}

L'identificateur \ggs+nom+ donne un nom à la \emph{méthode} de recherche~; ce nom doit être unique parmi ces \emph{méthodes}. La chaîne de caractères \ggs+"message_erreur"+ définit le message d'erreur qui est affiché en cas de recherche d'une clé inexistante. Cette chaîne accepte une séquence d'échappement~:
\begin{itemize}
  \item \texttt{\%K}, qui est remplacée par la chaîne de caractères de la clé inexistante recherchée.
\end{itemize}


Une \emph{méthode} de recherche est appelée dans une \emph{instruction d'appel de méthode}~:
\begin{itemize}
  \item le premier argument (sortie) est une expression de type \ggs+@lstring+ qui caractérise la clé à rechercher~;
  \item ensuite, pour chaque propriété déclarée, un argument en entrée nommant une variable destinée à recevoir la valeur de la propriété correspondante.
\end{itemize}

Par exemple~:
\begin{galgas}
var @MaTable uneTable = {}
...
var @lstring clef = ...
[uneTable searchKey !clef ?@string s ?@uint v]
\end{galgas}






\sectionLabel{Setters de retrait}{setterRetraitTable}

Une \ggs+map+ peut déclarer zéro, un ou plusieurs \emph{setters} de retrait. Un \emph{setter} de recherche permet de retirer une entrée d'une table, et retourne la valeur des propriétés de la clé retirée. Une erreur est déclenchée si la clé n'existe pas.


Un \emph{setter} de retrait est déclaré par~:

\begin{galgas}
%removeSetter nom %errorMessage "message_erreur"
\end{galgas}

L'identificateur \ggs+nom+ donne un nom au \emph{setter} de retrait~; ce nom doit être unique parmi les \emph{setters} d'insertion et de retrait. La chaîne de caractères \ggs+"message_erreur"+ définit le message d'erreur qui est affiché en cas de recherche d'une clé inexistante. Cette chaîne accepte une séquence d'échappement~:
\begin{itemize}
  \item \texttt{\%K}, qui est remplacée par la chaîne de caractères de la clé inexistante à retirer.
\end{itemize}


Un \emph{setter} de retrait est appelé dans une \emph{instruction d'appel de setter}~:
\begin{itemize}
  \item le premier argument (sortie) est une expression de type \ggs+@lstring+ qui caractérise la clé à retirer~;
  \item ensuite, pour chaque propriété déclarée, un argument en entrée nommant une variable destinée à recevoir la valeur de la propriété correspondante de la clé retirée.
\end{itemize}

Par exemple~:
\begin{galgas}
var @MaTable uneTable = {}
...
var @lstring clef = ...
[!?uneTable removeKey !clef ?@string s ?@uint v]
\end{galgas}

\sectionLabel{Getters}{gettersDeTable}

%\subsection{Getter \texttt{allKeyList}}
%
%\begin{galgas}
%getter @T allKeyList -> @lstringlist
%\end{galgas}
%
%Le \emph{getter} \ggs+allKeyList+ retourne la liste construite avec toutes les clés du récepteur, dans la table de premier niveau et dans les tables surchargées. L'ordre de la liste est~:
%\begin{itemize}
%  \item d'abord les clés de la table de premier niveau, puis celles des tables surchargées, dans l'ordre de la surcharge~;
%  \itel pour chaque table, les clés apparaissent dans l'ordre alphabétique croissant.
%\end{itemize}

\subsection{Getter \texttt{count}}

\begin{galgas}
getter count -> @uint
\end{galgas}


Le \emph{getter} \ggs+count+ retourne un \ggs+@uint+ qui contient le nombre d'entrées de la table de premier niveau du récepteur.



\subsection{Getter \texttt{hasKey}}

\begin{galgas}
getter hasKey ?@string inKey -> @bool
\end{galgas}


Le \emph{getter} \ggs+hasKey+ retourne un \ggs+@bool+ qui est \ggs+true+ si la clé \ggs+inKey+ est dans la table de premier niveau du récepteur, \ggs+false+ dans le cas contraire.



\subsection{Getter \texttt{keyList}}

\begin{galgas}
getter keyList -> @lstringlist
\end{galgas}


Le \emph{getter} \ggs+keyList+ retourne la liste construite avec toutes les clés de la table de premier niveau du récepteur. L'ordre de la liste est l'ordre alphabétique croissant des clés.



\subsection{Getter \texttt{keySet}}

\begin{galgas}
getter keySet -> @stringset
\end{galgas}


Le \emph{getter} \ggs+keySet+ retourne l'ensemble de toutes les clés de la table de premier niveau du récepteur.





\subsectionLabel{Getter \texttt{locationForKey}}{getterLocationForKey}

\begin{galgas}
getter locationForKey ?@string inKey -> @location
\end{galgas}


Le \emph{getter} \ggs+locationForKey+ retourne un \ggs+@location+ qui contient l'information de position de la clé \ggs+inKey+ dans la table de premier niveau du récepteur. Une erreur d'exécution est déclenchée si cette clé n'existe pas.








\subsection{Getter \texttt{overriddenMap}}

\begin{galgas}
getter overriddenMap -> @T
\end{galgas}


Le \emph{getter} \ggs+overriddenMap+ retourne la table obtenue en amputant de la valeur du récepteur la table de premier niveau. Si le récepteur n'a pas de table surchargée, une erreur d'exécution est déclenchée.



\section{Énumération}

L'instruction \ggs+for+ permet d'énumérer des objets de type \ggs+map+ ; elle est décrite à la \refSectionPage{instructionFor}.

